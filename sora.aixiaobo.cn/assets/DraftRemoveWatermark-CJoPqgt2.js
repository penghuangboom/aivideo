import{d as ae,u as se,a as oe,b as M,q as ne,m as re,r as p,p as m,c as i,e,f as g,t as n,g as r,h as le,v as ce,D as ie,F as de,B as ue,w as N,n as c,A as me,o as d,_ as ve}from"./index-InSkuxQ1.js";const pe={class:"draft-remove-watermark-page"},he={class:"at-notice card"},fe={class:"notice-content"},_e={class:"notice-text"},ge={class:"at-config-section card"},ke={class:"hint"},be={class:"at-input-group"},ye={class:"input-with-button"},Re=["placeholder","disabled"],we=["disabled"],xe={key:0,class:"at-status"},We={class:"status-text"},Te={class:"card"},Ue={class:"hint"},Ce={class:"draft-input-row"},Se=["disabled"],Ae={key:0,class:"stats-section card"},Le={class:"stats-grid"},De={class:"stat-item"},Ve={class:"stat-label"},$e={class:"stat-value"},Ee={class:"stat-item success"},Me={class:"stat-label"},Ne={class:"stat-value"},Oe={class:"stat-item error"},Fe={class:"stat-label"},Ie={class:"stat-value"},je={class:"stat-item"},Pe={class:"stat-label"},qe={class:"stat-value"},Be={key:0,class:"progress-bar"},ze={class:"progress-text"},He={key:1,class:"success-notification"},Ge={key:1,class:"output-section card"},Je={class:"section-header"},Ke={class:"textarea-group"},Qe=["value","placeholder"],Ye={class:"textarea-footer"},Xe={class:"count-text"},Ze={key:2,class:"tasks-section card"},et={class:"video-grid"},tt=["onClick"],at=["src","alt"],st={key:1,class:"thumbnail-placeholder"},ot={class:"thumbnail-text"},nt={class:"video-info"},rt=["title"],lt={class:"video-time"},ct=["onClick","title"],it={class:"modal-header"},dt={class:"modal-body"},ut={class:"url-display"},mt=["value"],vt=["href"],O="sora_at_value",pt=ae({__name:"DraftRemoveWatermark",setup(ht){const{t}=se(),T=re(),F=oe(),I=M(),j=()=>{const a=I.config.qrCodeUrl,s=document.createElement("div");s.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
  `,s.innerHTML=`
    <div style="
      background: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    ">
      <h3 style="margin: 0 0 20px 0; color: #333;">è”ç³»å®¢æœ</h3>
      <img src="${a}" alt="å®¢æœäºŒç»´ç " style="width: 200px; height: 200px; border-radius: 10px;" />
      <p style="margin: 20px 0 0 0; color: #666;">æ‰«æäºŒç»´ç è”ç³»å®¢æœå‡çº§ä¼šå‘˜</p>
      <button onclick="this.closest('div[style*=fixed]').remove()" style="
        margin-top: 20px;
        padding: 10px 30px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
      ">å…³é—­</button>
    </div>
  `,s.onclick=o=>{o.target===s&&s.remove()},document.body.appendChild(s)};ne(()=>{if(!F.hasAdvancedPermission){const s=M().config.features.enableVipOnlyMode||!1;confirm(`æƒé™ä¸è¶³

æ‚¨å½“å‰çš„è´¦æˆ·æƒé™ä¸è¶³ï¼Œæ— æ³•ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚

è¯·è”ç³»å®¢æœå‡çº§ç­‰çº§`)&&j(),T.push("/generate")}});const P=p(""),v=p([]),k=p(!1),W=p(!1),R=p(""),h=p(""),b=p(!1),f=p(!1),U=localStorage.getItem(O);U&&(h.value=U,b.value=!0),m(()=>P.value.split(/\r?\n/).map(a=>a.trim()).filter(a=>a.length>0));const y=m(()=>v.value.filter(a=>a.status==="success")),q=m(()=>v.value.filter(a=>a.status==="failed")),B=m(()=>v.value.filter(a=>a.status==="pending")),w=m(()=>y.value.length),C=m(()=>q.value.length),z=m(()=>B.value.length),S=m(()=>{if(v.value.length===0)return 0;const a=w.value+C.value;return Math.round(a/v.value.length*100)}),A=m(()=>y.value.map(a=>a.mp4Url).filter(a=>a).join(`
`));function H(){const a=A.value;if(!a){c.warning(t("draftRemoveWatermark.noContentToDownload"));return}const s=new Blob([a],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(s),l=document.createElement("a");l.href=o,l.download=`è‰ç¨¿å»æ°´å°_${new Date().getTime()}.txt`,l.click(),URL.revokeObjectURL(o)}function G(a){a&&(R.value=a,W.value=!0)}function L(){W.value=!1,R.value=""}async function J(){try{await navigator.clipboard.writeText(R.value),c.success(t("common.copySuccess"))}catch{c.error(t("common.copyFailed"))}}async function K(a,s){if(!a){c.error(t("draftRemoveWatermark.videoUrlNotExist"));return}try{console.log("ğŸ“¥ å¼€å§‹ä¸‹è½½è§†é¢‘:",s);const o=await fetch(a);if(!o.ok)throw new Error(`ä¸‹è½½å¤±è´¥: ${o.status}`);const l=await o.blob(),_=URL.createObjectURL(l),u=document.createElement("a");u.href=_,u.download=s,u.click(),setTimeout(()=>URL.revokeObjectURL(_),100),console.log("âœ… è§†é¢‘ä¸‹è½½æˆåŠŸ:",s)}catch(o){console.error("âŒ è§†é¢‘ä¸‹è½½å¤±è´¥:",o),c.error(`${t("draftRemoveWatermark.downloadFailed")}: ${o.message}`)}}function Q(a){const s=a.target;console.log("âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ:",s.src)}function Y(a){var l;const s=a.target;console.error("âŒ å›¾ç‰‡åŠ è½½å¤±è´¥:",s.src),s.style.display="none";const o=(l=s.parentElement)==null?void 0:l.querySelector(".thumbnail-placeholder");o&&(o.style.display="flex")}function X(){window.open("https://sora.chatgpt.com/api/auth/session","_blank")}function Z(){let a=h.value.trim();if(!a){c.warning(t("draftRemoveWatermark.pleaseInputAT"));return}try{const s=JSON.parse(a);s.accessToken&&(a=s.accessToken,h.value=a,console.log("âœ… å·²è‡ªåŠ¨æå– accessToken"))}catch{console.log("è¾“å…¥çš„ä¸æ˜¯ JSON æ ¼å¼ï¼Œç›´æ¥ä½¿ç”¨åŸå§‹å€¼")}localStorage.setItem(O,a),b.value=!0,c.success(t("draftRemoveWatermark.atSavedSuccess"))}function ee(){if(!b.value){c.warning(t("draftRemoveWatermark.pleaseGetAT"));return}if(k.value){c.warning(t("draftRemoveWatermark.processingWait"));return}if(f.value){c.warning(t("draftRemoveWatermark.fetchingWait"));return}te()}async function te(){var a,s;if(!b.value){c.warning(t("draftRemoveWatermark.pleaseSaveAT"));return}f.value=!0;try{console.log("ğŸ¬ å¼€å§‹è·å–æœ€è¿‘ 30 ä¸ªè‰ç¨¿è§†é¢‘...");const l=await me.removeDraftWatermark(h.value.trim(),30);if(console.log("ğŸ“¥ è‰ç¨¿å»æ°´å°å“åº”:",l),l.data&&Array.isArray(l.data)&&l.data.length>0){const _=l.data.slice(0,30);v.value=_.map((u,D)=>{var V,$,E;const x={index:D+1,url:u.id,status:"success",prompt:u.prompt||"è‰ç¨¿è§†é¢‘",mp4Url:((V=u.videos[0])==null?void 0:V.source_path)||"",thumbnailUrl:(($=u.videos[0])==null?void 0:$.thumbnail_path)||"",gifUrl:((E=u.videos[0])==null?void 0:E.gif_path)||"",processedAt:new Date().toLocaleString("zh-CN")};return console.log(`ğŸ“¹ è‰ç¨¿ ${D+1}:`,{prompt:x.prompt,thumbnailUrl:x.thumbnailUrl,mp4Url:x.mp4Url}),x}),c.success(t("draftRemoveWatermark.fetchSuccess",{count:_.length}))}else c.error(t("draftRemoveWatermark.noDraftsFound"))}catch(o){console.error("è·å–è‰ç¨¿å¤±è´¥:",o);const l=((s=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:s.message)||(o==null?void 0:o.message)||t("common.requestFailed");alert(`âŒ è·å–è‰ç¨¿å¤±è´¥: ${l}\\n\\nè¯·ç¡®è®¤ï¼š\\n1. AT å€¼æ˜¯å¦æ­£ç¡®\\n2. æ˜¯å¦å·²ç™»å½• Sora å®˜ç½‘\\n3. è´¦å·æ˜¯å¦æœ‰è‰ç¨¿è§†é¢‘`)}finally{f.value=!1}}return(a,s)=>(d(),i("div",pe,[e("div",he,[e("div",fe,[s[2]||(s[2]=e("div",{class:"notice-icon"},"âš ï¸",-1)),e("div",_e,[e("h4",null,n(r(t)("draftRemoveWatermark.atNoticeTitle")),1),e("p",null,n(r(t)("draftRemoveWatermark.atNoticeText")),1)])]),e("button",{onClick:X,class:"btn-get-at"},n(r(t)("draftRemoveWatermark.getATValue")),1)]),e("div",ge,[e("h3",null,n(r(t)("draftRemoveWatermark.atConfigTitle")),1),e("p",ke,n(r(t)("draftRemoveWatermark.atConfigHint")),1),e("div",be,[e("label",null,n(r(t)("draftRemoveWatermark.atLabel")),1),e("div",ye,[le(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>h.value=o),type:"text",placeholder:r(t)("draftRemoveWatermark.atPlaceholder"),disabled:k.value||f.value},null,8,Re),[[ce,h.value]]),e("button",{onClick:Z,disabled:!h.value.trim()||k.value||f.value,class:"btn-save"},n(r(t)("draftRemoveWatermark.saveAT")),9,we)]),b.value?(d(),i("div",xe,[s[3]||(s[3]=e("span",{class:"status-icon"},"âœ…",-1)),e("span",We,n(r(t)("draftRemoveWatermark.atSaved")),1)])):g("",!0)])]),e("div",Te,[e("h3",null,n(r(t)("draftRemoveWatermark.oneClickTitle")),1),e("p",Ue,n(r(t)("draftRemoveWatermark.oneClickHint")),1),e("div",Ce,[e("button",{onClick:ee,disabled:!b.value||k.value||f.value,class:"btn-fetch-drafts"},n(f.value?r(t)("draftRemoveWatermark.processing"):r(t)("draftRemoveWatermark.startRemove")),9,Se)])]),v.value.length>0?(d(),i("div",Ae,[e("h3",null,n(r(t)("draftRemoveWatermark.statsTitle")),1),e("div",Le,[e("div",De,[e("span",Ve,n(r(t)("draftRemoveWatermark.totalTasks")),1),e("span",$e,n(v.value.length),1)]),e("div",Ee,[e("span",Me,n(r(t)("draftRemoveWatermark.success")),1),e("span",Ne,n(w.value),1)]),e("div",Oe,[e("span",Fe,n(r(t)("draftRemoveWatermark.failed")),1),e("span",Ie,n(C.value),1)]),e("div",je,[e("span",Pe,n(r(t)("draftRemoveWatermark.pending")),1),e("span",qe,n(z.value),1)])]),k.value?(d(),i("div",Be,[e("div",{class:"progress-fill",style:ie({width:S.value+"%"})},null,4),e("span",ze,n(S.value)+"%",1)])):g("",!0),w.value>0&&!k.value?(d(),i("div",He,n(r(t)("draftRemoveWatermark.successNotification",{count:w.value})),1)):g("",!0)])):g("",!0),y.value.length>0?(d(),i("div",Ge,[e("div",Je,[e("h3",null,n(r(t)("draftRemoveWatermark.outputTitle")),1),e("button",{onClick:H,class:"btn-download"},n(r(t)("draftRemoveWatermark.downloadTxt")),1)]),e("div",Ke,[e("textarea",{value:A.value,readonly:"",rows:"10",placeholder:r(t)("batchRemoveWatermark.outputPlaceholder")},null,8,Qe),e("div",Ye,[e("span",Xe,n(r(t)("draftRemoveWatermark.successAddressCount",{count:y.value.length})),1)])])])):g("",!0),y.value.length>0?(d(),i("div",Ze,[e("h3",null,n(r(t)("draftRemoveWatermark.videoListTitle")),1),e("div",et,[(d(!0),i(de,null,ue(y.value,(o,l)=>(d(),i("div",{key:l,class:"video-item"},[e("div",{class:"video-thumbnail",onClick:_=>G(o.mp4Url)},[o.thumbnailUrl?(d(),i("img",{key:0,src:o.thumbnailUrl,alt:o.prompt,class:"thumbnail-image",crossorigin:"anonymous",onLoad:Q,onError:Y},null,40,at)):(d(),i("div",st,[s[4]||(s[4]=e("span",{class:"play-icon"},"â–¶ï¸",-1)),e("p",ot,n(r(t)("draftRemoveWatermark.noThumbnail")),1)])),s[5]||(s[5]=e("div",{class:"thumbnail-overlay"},[e("span",{class:"play-icon"},"â–¶ï¸")],-1))],8,tt),e("div",nt,[e("p",{class:"video-prompt",title:o.prompt},n(o.prompt||r(t)("draftRemoveWatermark.draftVideo")),9,rt),e("p",lt,n(o.processedAt),1),e("button",{class:"download-btn-card",onClick:N(_=>K(o.mp4Url||"",`${r(t)("draftRemoveWatermark.draftVideo")}_${l+1}.mp4`),["stop"]),title:r(t)("generate.downloadVideo")}," â¬‡ï¸ ",8,ct)])]))),128))])])):g("",!0),W.value?(d(),i("div",{key:3,class:"modal",onClick:L},[e("div",{class:"modal-content",onClick:s[1]||(s[1]=N(()=>{},["stop"]))},[e("div",it,[e("h4",null,n(r(t)("draftRemoveWatermark.addressDetails")),1),e("button",{onClick:L,class:"btn-close"},"âœ•")]),e("div",dt,[e("div",ut,[e("input",{type:"text",value:R.value,readonly:""},null,8,mt),e("button",{onClick:J,class:"btn-copy"},n(r(t)("common.copy")),1)]),e("a",{href:R.value,target:"_blank",class:"btn-open"},n(r(t)("draftRemoveWatermark.openInNewWindow")),9,vt)])])])):g("",!0)]))}}),_t=ve(pt,[["__scopeId","data-v-2efc4bfc"]]);export{_t as default};
