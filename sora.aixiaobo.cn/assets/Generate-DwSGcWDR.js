import{d as me,u as he,a as be,b as ye,r as u,p as U,y as ke,q as we,z as Te,c as r,f as v,e as s,g as n,x as Ce,t as a,w as z,h as De,v as Ie,F as J,B as K,C as V,D as Me,n as R,A as F,o as i,_ as xe}from"./index-InSkuxQ1.js";import{a as Pe,u as Se}from"./taskHistory-CM6jBMei.js";const Le={class:"generate-page"},$e={key:0,class:"roadmap-banner tech-banner"},Ue={class:"banner-content"},Ve={class:"banner-tag tech"},Fe={class:"content-grid"},Oe={class:"form-section card"},He={class:"form-group"},Ae={class:"label-text"},ze=["placeholder"],Re={class:"hint"},Be={class:"form-row"},Ee={class:"form-group"},Ne={class:"label-text"},qe={class:"custom-select-wrapper"},Ge={class:"select-value"},je=["onClick"],Qe={class:"option-label"},We={key:0,class:"check-icon"},Je={class:"form-group"},Ke={class:"label-text"},Xe={class:"custom-select-wrapper"},Ye={class:"select-value"},Ze=["onClick","disabled"],et={class:"option-label"},tt={key:0,class:"check-icon"},st={key:0,class:"hint"},at={class:"form-group"},ot={class:"label-text"},nt={class:"file-upload"},lt={for:"imageInput",class:"file-label"},rt={key:0},it={key:1},ct={key:0,class:"image-preview"},ut=["src","alt"],dt={class:"hint"},vt={class:"model-info"},pt={class:"info-item"},gt={class:"info-label"},_t={class:"info-value"},ft={class:"info-item"},mt={class:"info-label"},ht={class:"info-value"},bt=["disabled"],yt={key:0},kt={key:1},wt={key:0,class:"status-section card"},Tt={class:"task-info"},Ct={class:"info-row"},Dt={class:"label"},It={class:"value task-id"},Mt={class:"info-row"},xt={class:"label"},Pt={class:"value"},St={class:"info-row"},Lt={class:"label"},$t={class:"value"},Ut={class:"progress-section"},Vt={class:"progress-label"},Ft={class:"progress-percent"},Ot={key:0,class:"progress-time"},Ht={class:"progress-bar-container"},At={class:"time-info"},zt={class:"time-item"},Rt={class:"time-label"},Bt={class:"time-value"},Et={key:0,class:"time-item"},Nt={class:"time-label"},qt={class:"time-value"},Gt={key:0,class:"video-preview-section"},jt=["src"],Qt={key:1,class:"action-section"},Wt={key:2,class:"error-section"},Jt={class:"error-message"},Kt={key:1,class:"status-section card placeholder"},Xt={class:"placeholder-content"},Yt={class:"placeholder-hint"},Zt=me({__name:"Generate",setup(es){const{t:o,locale:X}=he(),B=be(),y=ye(),m=u(""),k=u(1),d=u(1),p=u(null),x=u(!1),w=u(!1),T=u(!1),E=U(()=>[{value:1,label:o("generate.orientationLandscape")},{value:2,label:o("generate.orientationPortrait")}]),P=U(()=>{var W;const t=((W=B.profile)==null?void 0:W.group)||"default",e=t==="vip"||t==="svip",l=y.config.durationConfig||{enable25sPro:!0,enable15sProHD:!0,restrictionText:"éœ€è¦å‡çº§"},_=l.enable25sPro??!0,f=l.enable15sProHD??!0,h=l.restrictionText||"éœ€è¦å‡çº§",c=!_&&!e,$=!f&&!e;return[{value:1,label:o("generate.duration10s"),disabled:!1},{value:2,label:o("generate.duration15s"),disabled:!1},{value:3,label:o("generate.duration25s")+(c?` ${h}`:""),disabled:c},{value:4,label:o("generate.duration15sHD")+($?` ${h}`:""),disabled:$}]}),Y=()=>{w.value=!w.value,w.value&&(T.value=!1)},Z=()=>{T.value=!T.value,T.value&&(w.value=!1)},ee=t=>{k.value=t,w.value=!1},te=t=>{const e=P.value.find(l=>l.value===t);e!=null&&e.disabled||(d.value=t,T.value=!1)},se=t=>{const e=E.value.find(l=>l.value===t);return(e==null?void 0:e.label)||""},ae=t=>{const e=P.value.find(l=>l.value===t);return(e==null?void 0:e.label)||""},N=t=>{const e=P.value.find(l=>l.value===t);return e?!e.disabled:!1};ke(d,t=>{var e;if(!N(t)){const _=(y.config.durationConfig||{restrictionText:"éœ€è¦å‡çº§"}).restrictionText||"éœ€è¦å‡çº§",f=((e=B.profile)==null?void 0:e.group)||"default";f==="vip"||f==="svip"||(R.warning(`æ­¤æ—¶é•¿é€‰é¡¹${_}æ‰èƒ½ä½¿ç”¨ã€‚å·²è‡ªåŠ¨åˆ‡æ¢ä¸º10ç§’ã€‚`,"æƒé™é™åˆ¶"),d.value=1)}});const g=u(""),O=u(""),C=u(""),S=u(0),q=u(0),H=u(0),D=u(""),L=u("");let A,I;const b=u(0),M=u(0),oe=U(()=>k.value===2||O.value.includes("portrait")),G=U(()=>{const t=S.value||0,e=Math.max(b.value,t);return Math.floor(e)});function ne(t){var l;const e=(l=t.target.files)==null?void 0:l[0];if(p.value=e||null,e){const _=new FileReader;_.onload=f=>{var h;D.value=(h=f.target)==null?void 0:h.result},_.readAsDataURL(e),console.log("âœ… å›¾ç‰‡å·²é€‰æ‹©:",e.name,e.type,e.size)}else D.value=""}function le(){p.value=null,D.value="";const t=document.getElementById("imageInput");t&&(t.value=""),console.log("ðŸ—‘ï¸ å›¾ç‰‡å·²æ¸…é™¤")}function re(){const t=k.value===1;return d.value===4?t?"sora2-pro-landscape-hd-15s":"sora2-pro-portrait-hd-15s":d.value===3?t?"sora2-pro-landscape-25s":"sora2-pro-portrait-25s":d.value===2?t?"sora2-landscape-15s":"sora2-portrait-15s":t?"sora2-landscape":"sora2-portrait"}async function ie(){if(!m.value){R.warning("è¯·è¾“å…¥æŒ‡ä»¤");return}console.log("========== å¼€å§‹æäº¤ä»»åŠ¡ =========="),console.log("imageFile.value:",p.value),console.log("æ˜¯å¦æœ‰å›¾ç‰‡:",!!p.value),x.value=!0;try{const t=re();let e;if(p.value){console.log("ðŸ–¼ï¸ ä½¿ç”¨å›¾ç”Ÿè§†é¢‘æ¨¡å¼"),console.log("å›¾ç‰‡æ–‡ä»¶:",p.value.name,p.value.type,p.value.size),console.log("æç¤ºè¯:",m.value),console.log("æ¨¡åž‹:",t);const l=new FormData;l.append("input_reference",p.value),l.append("prompt",m.value),l.append("model",t),console.log("FormData å†…å®¹:");for(let[_,f]of l.entries())console.log(`  ${_}:`,f);e=await F.createImageToVideo(l),console.log("å›¾ç”Ÿè§†é¢‘å“åº”:",e)}else console.log("ðŸ“ ä½¿ç”¨æ–‡ç”Ÿè§†é¢‘æ¨¡å¼"),console.log("æç¤ºè¯:",m.value),console.log("æ¨¡åž‹:",t),e=await F.createTextToVideo({prompt:m.value,model:t}),console.log("æ–‡ç”Ÿè§†é¢‘å“åº”:",e);console.log("========== ä»»åŠ¡æäº¤å®Œæˆ =========="),g.value=e.id,O.value=e.model,C.value=e.status,S.value=e.progress,q.value=e.created_at,console.log("âœ… ä»»åŠ¡å·²æäº¤ï¼Œä»»åŠ¡ID:",e.id),console.log('ðŸ’¡ æç¤ºï¼šä»»åŠ¡ä¼šè‡ªåŠ¨å‡ºçŽ°åœ¨"ä»»åŠ¡è¿›åº¦"é¡µé¢'),Pe({taskId:e.id,type:"generate",status:"queued",progress:0,submittedAt:new Date().toISOString(),prompt:m.value}),ce(),de()}catch(t){console.error("æäº¤å¤±è´¥:",t)}finally{x.value=!1}}function ce(){b.value=0,M.value=Date.now(),clearInterval(I);let t=0;I=setInterval(()=>{const e=Math.floor((Date.now()-M.value)/1e3);if((S.value||0)>=50){clearInterval(I);return}if(e<=15)e>t&&(b.value=Math.min(50,b.value+Math.floor(Math.random()*2)+1),t=e);else if(e<=90){const l=Math.floor(Math.random()*3)+3;e-t>=l&&(b.value=Math.min(50,b.value+1),t=e)}else clearInterval(I),b.value=Math.min(50,b.value)},1e3)}function ue(){if(M.value===0)return"";const t=Math.floor((Date.now()-M.value)/1e3),e=Math.floor(t/60),l=t%60;return`${e}:${l.toString().padStart(2,"0")}`}async function de(){clearInterval(A),A=setInterval(async()=>{if(g.value)try{const t=await F.getVideoTask(g.value);if(C.value=t.status,S.value=t.progress,t.completed_at&&(H.value=t.completed_at),t.status==="completed"&&g.value)try{L.value=`/v1/videos/${g.value}/content`,console.log("âœ… è§†é¢‘ç”Ÿæˆå®Œæˆï¼Œé¢„è§ˆ URL:",L.value)}catch(e){console.error("èŽ·å–è§†é¢‘ URL å¤±è´¥",e)}Se(g.value,{status:t.status,progress:t.progress,finishedAt:t.completed_at?new Date(t.completed_at*1e3).toISOString():void 0}),(t.status==="completed"||t.status==="failed")&&(clearInterval(A),clearInterval(I))}catch(t){console.error("è½®è¯¢å¤±è´¥",t)}},3e3)}async function ve(){if(g.value)try{const t=await F.getVideoContent(g.value),e=URL.createObjectURL(t),l=document.createElement("a");l.href=e,l.download=`${g.value}.mp4`,l.click(),URL.revokeObjectURL(e)}catch(t){R.error("ä¸‹è½½å¤±è´¥ï¼š"+((t==null?void 0:t.message)||""))}}function j(t){return new Date(t*1e3).toLocaleString("zh-CN")}function pe(t){const e=X.value;return e==="en-US"?t:e==="zh-CN"?t.replace(/landscape/g,"æ¨ªå±").replace(/portrait/g,"ç«–å±").replace(/hd/g,"é«˜æ¸…"):e==="zh-TW"?t.replace(/landscape/g,"æ©«å±").replace(/portrait/g,"è±Žå±").replace(/hd/g,"é«˜æ¸…"):t}function ge(){const t=k.value===1;let e="";return d.value===4?e=t?"sora2-pro-landscape-hd-15s":"sora2-pro-portrait-hd-15s":d.value===3?e=t?"sora2-pro-landscape-25s":"sora2-pro-portrait-25s":d.value===2?e=t?"sora2-landscape-15s":"sora2-portrait-15s":e=t?"sora2-landscape":"sora2-portrait",pe(e)}function _e(){return`${d.value===3||d.value===4?"15-30":"3-5"} ${o("generate.minutes")}`}function fe(t){return{queued:`â³ ${o("history.statusQueued")}`,processing:`ðŸ”„ ${o("history.statusProcessing")}`,in_progress:`ðŸ”„ ${o("history.statusProcessing")}`,completed:`âœ… ${o("history.statusCompleted")}`,failed:`âŒ ${o("history.statusFailed")}`}[t]||t}function Q(t){t.target.closest(".custom-select-wrapper")||(w.value=!1,T.value=!1)}return we(()=>{document.addEventListener("click",Q)}),Te(()=>{document.removeEventListener("click",Q)}),(t,e)=>{var l,_,f,h;return i(),r("div",Le,[n(y).config.features.enableBanner?(i(),r("div",$e,[e[3]||(e[3]=s("div",{class:"banner-icon"},"âš¡",-1)),s("div",Ue,[s("strong",null,a(((l=n(y).config.features.bannerConfig)==null?void 0:l.title)||n(o)("generate.banner")),1),Ce(" "+a(((_=n(y).config.features.bannerConfig)==null?void 0:_.description)||n(o)("generate.bannerDesc")),1)]),s("div",Ve,a(((f=n(y).config.features.bannerConfig)==null?void 0:f.tag)||n(o)("generate.bannerTag")),1)])):v("",!0),s("div",Fe,[s("div",Oe,[s("h3",null,a(n(o)("generate.formTitle")),1),s("form",{onSubmit:z(ie,["prevent"])},[s("div",He,[s("label",null,[s("span",Ae,"ðŸ“ "+a(n(o)("generate.prompt")),1),e[4]||(e[4]=s("span",{class:"required"},"*",-1))]),De(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=c=>m.value=c),placeholder:n(o)("generate.promptPlaceholder"),rows:"4",class:"prompt-input"},null,8,ze),[[Ie,m.value,void 0,{trim:!0}]]),s("div",Re,a(n(o)("generate.promptHint")),1)]),s("div",Be,[s("div",Ee,[s("label",null,[s("span",Ne,"ðŸ“ "+a(n(o)("generate.orientation")),1)]),s("div",qe,[s("button",{type:"button",class:"custom-select-btn",onClick:Y},[s("span",Ge,a(se(k.value)),1),e[5]||(e[5]=s("span",{class:"select-arrow"},"â–¼",-1))]),w.value?(i(),r("div",{key:0,class:"custom-select-menu",onClick:e[1]||(e[1]=z(()=>{},["stop"]))},[(i(!0),r(J,null,K(E.value,c=>(i(),r("button",{type:"button",key:c.value,onClick:$=>ee(c.value),class:V(["select-option",{active:k.value===c.value}])},[s("span",Qe,a(c.label),1),k.value===c.value?(i(),r("span",We,"âœ“")):v("",!0)],10,je))),128))])):v("",!0)])]),s("div",Je,[s("label",null,[s("span",Ke,"â±ï¸ "+a(n(o)("generate.duration")),1)]),s("div",Xe,[s("button",{type:"button",class:"custom-select-btn",onClick:Z},[s("span",Ye,a(ae(d.value)),1),e[6]||(e[6]=s("span",{class:"select-arrow"},"â–¼",-1))]),T.value?(i(),r("div",{key:0,class:"custom-select-menu",onClick:e[2]||(e[2]=z(()=>{},["stop"]))},[(i(!0),r(J,null,K(P.value,c=>(i(),r("button",{type:"button",key:c.value,onClick:$=>te(c.value),class:V(["select-option",{active:d.value===c.value,disabled:c.disabled}]),disabled:c.disabled},[s("span",et,a(c.label),1),d.value===c.value?(i(),r("span",tt,"âœ“")):v("",!0)],10,Ze))),128))])):v("",!0)]),N(d.value)?v("",!0):(i(),r("div",st,a(((h=n(y).config.durationConfig)==null?void 0:h.restrictionText)||"éœ€è¦å‡çº§"),1))])]),s("div",at,[s("label",null,[s("span",ot,"ðŸ–¼ï¸ "+a(n(o)("generate.referenceImage")),1)]),s("div",nt,[s("input",{type:"file",onChange:ne,accept:"image/*",id:"imageInput",class:"file-input"},null,32),s("label",lt,[p.value?(i(),r("span",it,a(n(o)("generate.imageSelected"))+" "+a(p.value.name),1)):(i(),r("span",rt,a(n(o)("generate.chooseImage")),1))]),p.value?(i(),r("button",{key:0,onClick:le,type:"button",class:"clear-btn"},a(n(o)("generate.clearImage")),1)):v("",!0)]),D.value?(i(),r("div",ct,[s("img",{src:D.value,alt:n(o)("generate.imagePreview")},null,8,ut)])):v("",!0),s("div",dt,a(n(o)("generate.imageHint")),1)]),s("div",vt,[s("div",pt,[s("span",gt,a(n(o)("generate.currentModel")),1),s("span",_t,a(ge()),1)]),s("div",ft,[s("span",mt,a(n(o)("generate.estimatedCost")),1),s("span",ht,a(_e()),1)])]),s("button",{type:"submit",disabled:x.value||!m.value,class:"submit-btn"},[x.value?(i(),r("span",kt,a(n(o)("generate.submitting")),1)):(i(),r("span",yt,a(n(o)("generate.submitButton")),1))],8,bt)],32)]),g.value?(i(),r("div",wt,[s("h3",null,a(n(o)("generate.taskStatus")),1),s("div",Tt,[s("div",Ct,[s("span",Dt,a(n(o)("generate.taskId")),1),s("span",It,a(g.value),1)]),s("div",Mt,[s("span",xt,a(n(o)("generate.model")),1),s("span",Pt,a(O.value),1)]),s("div",St,[s("span",Lt,a(n(o)("generate.status")),1),s("span",$t,[s("span",{class:V(["status-badge",C.value])},a(fe(C.value)),3)])])]),s("div",Ut,[s("div",Vt,[s("span",null,a(n(o)("generate.progress")),1),s("span",Ft,a(G.value)+"%",1),M.value>0?(i(),r("span",Ot,a(ue()),1)):v("",!0)]),s("div",Ht,[s("div",{class:"progress-bar-fill",style:Me({width:G.value+"%"})},null,4)])]),s("div",At,[s("div",zt,[s("span",Rt,a(n(o)("generate.createdTime")),1),s("span",Bt,a(j(q.value)),1)]),H.value?(i(),r("div",Et,[s("span",Nt,a(n(o)("generate.completedTime")),1),s("span",qt,a(j(H.value)),1)])):v("",!0)]),C.value==="completed"&&L.value?(i(),r("div",Gt,[s("h4",null,a(n(o)("generate.videoPreview")),1),s("div",{class:V(["video-container",{portrait:oe.value}])},[s("video",{src:L.value,controls:"",class:"video-player",preload:"metadata"},a(n(o)("generate.browserNotSupport")),9,jt)],2)])):v("",!0),C.value==="completed"?(i(),r("div",Qt,[s("button",{onClick:ve,class:"download-btn"},a(n(o)("generate.downloadVideo")),1)])):v("",!0),C.value==="failed"?(i(),r("div",Wt,[s("div",Jt,a(n(o)("generate.generateFailed")),1)])):v("",!0)])):(i(),r("div",Kt,[s("div",Xt,[e[7]||(e[7]=s("div",{class:"placeholder-icon"},"ðŸŽ¥",-1)),s("p",null,a(n(o)("generate.placeholderTitle")),1),s("p",Yt,a(n(o)("generate.placeholderHint")),1)])]))])])}}}),as=xe(Zt,[["__scopeId","data-v-d7a02f8c"]]);export{as as default};
