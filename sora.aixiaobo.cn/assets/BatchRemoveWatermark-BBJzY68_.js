import{d as E,u as G,a as H,b as S,q as Q,m as J,r as g,p as h,c as r,e as t,f as _,t as s,g as n,h as K,v as X,D as Y,F as Z,B as tt,w as et,A as st,o as i,_ as at}from"./index-InSkuxQ1.js";const ot={class:"batch-remove-watermark-page"},lt={class:"input-section card"},nt={class:"hint"},ct={class:"textarea-group"},rt=["placeholder","disabled"],it={class:"textarea-footer"},ut={class:"count-text"},dt={class:"action-buttons"},ht=["disabled"],vt=["disabled"],pt={key:0,class:"stats-section card"},mt={class:"stats-grid"},_t={class:"stat-item"},bt={class:"stat-label"},ft={class:"stat-value"},gt={class:"stat-item success"},kt={class:"stat-label"},xt={class:"stat-value"},yt={class:"stat-item error"},wt={class:"stat-label"},Rt={class:"stat-value"},Ct={class:"stat-item"},Ut={class:"stat-label"},Wt={class:"stat-value"},Tt={key:0,class:"progress-bar"},At={class:"progress-text"},Bt={key:1,class:"success-notification"},Lt={key:1,class:"output-section card"},Mt={class:"section-header"},St={class:"textarea-group"},Pt=["value","placeholder"],Dt={class:"textarea-footer"},Vt={class:"count-text"},$t={key:2,class:"tasks-section card"},jt={class:"table-container"},zt={class:"task-table"},Ft=["title"],It=["onClick"],Nt={key:1},Ot=["onClick"],qt={key:1},Et=["onClick"],Gt={key:1},Ht={class:"modal-body"},Qt={class:"url-display"},Jt=["value"],Kt=["href"],Xt=E({__name:"BatchRemoveWatermark",setup(Yt){const{t:l}=G(),C=J(),P=H(),D=S(),V=()=>{const e=D.config.qrCodeUrl,a=document.createElement("div");a.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
  `,a.innerHTML=`
    <div style="
      background: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    ">
      <h3 style="margin: 0 0 20px 0; color: #333;">è”ç³»å®¢æœ</h3>
      <img src="${e}" alt="å®¢æœäºŒç»´ç " style="width: 200px; height: 200px; border-radius: 10px;" />
      <p style="margin: 20px 0 0 0; color: #666;">æ‰«æäºŒç»´ç è”ç³»å®¢æœå‡çº§ä¼šå‘˜</p>
      <button onclick="this.closest('div[style*=fixed]').remove()" style="
        margin-top: 20px;
        padding: 10px 30px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
      ">å…³é—­</button>
    </div>
  `,a.onclick=o=>{o.target===a&&a.remove()},document.body.appendChild(a)};Q(()=>{if(!P.hasAdvancedPermission){const a=S().config.features.enableVipOnlyMode||!1;confirm(`æƒé™ä¸è¶³

æ‚¨å½“å‰çš„è´¦æˆ·æƒé™ä¸è¶³ï¼Œæ— æ³•ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚

è¯·è”ç³»å®¢æœå‡çº§ç­‰çº§`)&&V(),C.push("/generate")}});const k=g(""),d=g([]),p=g(!1),y=g(!1),b=g(""),w=h(()=>k.value.split(/\r?\n/).map(e=>e.trim()).filter(e=>e.length>0)),$=h(()=>w.value.length>0),m=h(()=>d.value.filter(e=>e.status==="success")),j=h(()=>d.value.filter(e=>e.status==="failed")),z=h(()=>d.value.filter(e=>e.status==="pending")),x=h(()=>m.value.length),U=h(()=>j.value.length),F=h(()=>z.value.length),W=h(()=>{if(d.value.length===0)return 0;const e=x.value+U.value;return Math.round(e/d.value.length*100)}),T=h(()=>m.value.map(e=>e.mp4Url).filter(e=>e).join(`
`));async function I(){var a,o,v,f,B,L,M;const e=w.value;if(e.length===0){alert("è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªè§†é¢‘åœ°å€");return}d.value=e.map((u,c)=>({index:c+1,url:u,status:"pending"})),p.value=!0;for(const u of d.value){u.status="processing";try{const c=await st.removeWatermark(u.url);(a=c.links)!=null&&a.mp4?(u.status="success",u.prompt=c.links.text||((o=c.post_info)==null?void 0:o.prompt)||"æ— æç¤ºè¯",u.mp4Url=c.links.mp4,u.thumbnailUrl=c.links.thumbnail,u.gifUrl=c.links.gif,u.processedAt=new Date().toLocaleString("zh-CN")):(u.status="failed",u.error=((B=(f=(v=c.choices)==null?void 0:v[0])==null?void 0:f.message)==null?void 0:B.content)||"è§£æå¤±è´¥")}catch(c){u.status="failed",u.error=((M=(L=c==null?void 0:c.response)==null?void 0:L.data)==null?void 0:M.message)||(c==null?void 0:c.message)||"è¯·æ±‚å¤±è´¥"}await new Promise(c=>setTimeout(c,500))}p.value=!1}function N(){d.value.length>0&&!confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ")||(k.value="",d.value=[])}function O(){const e=T.value;if(!e){alert("æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹");return}const a=new Blob([e],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(a),v=document.createElement("a");v.href=o,v.download=`æ‰¹é‡å»æ°´å°_${new Date().getTime()}.txt`,v.click(),URL.revokeObjectURL(o)}function R(e){e&&(b.value=e,y.value=!0)}function A(){y.value=!1,b.value=""}function q(){navigator.clipboard.writeText(b.value).then(()=>{alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}).catch(()=>{alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")})}return(e,a)=>(i(),r("div",ot,[t("div",lt,[t("h3",null,s(n(l)("batchRemoveWatermark.inputTitle")),1),t("p",nt,s(n(l)("batchRemoveWatermark.inputHint")),1),t("div",ct,[t("label",null,s(n(l)("batchRemoveWatermark.inputLabel")),1),K(t("textarea",{"onUpdate:modelValue":a[0]||(a[0]=o=>k.value=o),placeholder:n(l)("batchRemoveWatermark.inputPlaceholder"),rows:"10",disabled:p.value},null,8,rt),[[X,k.value]]),t("div",it,[t("span",ut,s(n(l)("batchRemoveWatermark.addressCount",{count:w.value.length})),1)])]),t("div",dt,[t("button",{onClick:I,disabled:!$.value||p.value,class:"btn-primary btn-large"},s(p.value?n(l)("batchRemoveWatermark.processing"):n(l)("batchRemoveWatermark.startBatch")),9,ht),t("button",{onClick:N,disabled:p.value,class:"btn-secondary btn-large"},s(n(l)("batchRemoveWatermark.clearAll")),9,vt)])]),d.value.length>0?(i(),r("div",pt,[t("h3",null,s(n(l)("batchRemoveWatermark.statsTitle")),1),t("div",mt,[t("div",_t,[t("span",bt,s(n(l)("batchRemoveWatermark.totalTasks")),1),t("span",ft,s(d.value.length),1)]),t("div",gt,[t("span",kt,s(n(l)("batchRemoveWatermark.success")),1),t("span",xt,s(x.value),1)]),t("div",yt,[t("span",wt,s(n(l)("batchRemoveWatermark.failed")),1),t("span",Rt,s(U.value),1)]),t("div",Ct,[t("span",Ut,s(n(l)("batchRemoveWatermark.pending")),1),t("span",Wt,s(F.value),1)])]),p.value?(i(),r("div",Tt,[t("div",{class:"progress-fill",style:Y({width:W.value+"%"})},null,4),t("span",At,s(W.value)+"%",1)])):_("",!0),x.value>0&&!p.value?(i(),r("div",Bt,s(n(l)("batchRemoveWatermark.successNotification",{count:x.value})),1)):_("",!0)])):_("",!0),m.value.length>0?(i(),r("div",Lt,[t("div",Mt,[t("h3",null,s(n(l)("batchRemoveWatermark.outputTitle")),1),t("button",{onClick:O,class:"btn-download"},s(n(l)("batchRemoveWatermark.downloadTxt")),1)]),t("div",St,[t("textarea",{value:T.value,readonly:"",rows:"10",placeholder:n(l)("batchRemoveWatermark.outputPlaceholder")},null,8,Pt),t("div",Dt,[t("span",Vt,s(n(l)("batchRemoveWatermark.successAddressCount",{count:m.value.length})),1)])])])):_("",!0),m.value.length>0?(i(),r("div",$t,[t("h3",null,s(n(l)("batchRemoveWatermark.videoListTitle")),1),t("div",jt,[t("table",zt,[a[2]||(a[2]=t("thead",null,[t("tr",null,[t("th",null,"åºå·"),t("th",null,"æç¤ºè¯"),t("th",null,"è§†é¢‘åœ°å€"),t("th",null,"å›¾ç‰‡åœ°å€"),t("th",null,"GIFåœ°å€"),t("th",null,"å¤„ç†æ—¶é—´")])],-1)),t("tbody",null,[(i(!0),r(Z,null,tt(m.value,(o,v)=>(i(),r("tr",{key:v},[t("td",null,s(v+1),1),t("td",{class:"prompt-cell",title:o.prompt},s(o.prompt||"-"),9,Ft),t("td",null,[o.mp4Url?(i(),r("button",{key:0,onClick:f=>R(o.mp4Url),class:"btn-link"}," æŸ¥çœ‹è§†é¢‘ ",8,It)):(i(),r("span",Nt,"-"))]),t("td",null,[o.thumbnailUrl?(i(),r("button",{key:0,onClick:f=>R(o.thumbnailUrl),class:"btn-link"}," æŸ¥çœ‹å›¾ç‰‡ ",8,Ot)):(i(),r("span",qt,"-"))]),t("td",null,[o.gifUrl?(i(),r("button",{key:0,onClick:f=>R(o.gifUrl),class:"btn-link"}," æŸ¥çœ‹GIF ",8,Et)):(i(),r("span",Gt,"-"))]),t("td",null,s(o.processedAt),1)]))),128))])])])])):_("",!0),y.value?(i(),r("div",{key:3,class:"modal",onClick:A},[t("div",{class:"modal-content",onClick:a[1]||(a[1]=et(()=>{},["stop"]))},[t("div",{class:"modal-header"},[a[3]||(a[3]=t("h4",null,"åœ°å€è¯¦æƒ…",-1)),t("button",{onClick:A,class:"btn-close"},"âœ•")]),t("div",Ht,[t("div",Qt,[t("input",{type:"text",value:b.value,readonly:""},null,8,Jt),t("button",{onClick:q,class:"btn-copy"},"ğŸ“‹ å¤åˆ¶")]),t("a",{href:b.value,target:"_blank",class:"btn-open"},"ğŸ”— åœ¨æ–°çª—å£æ‰“å¼€",8,Kt)])])])):_("",!0)]))}}),te=at(Xt,[["__scopeId","data-v-c99cec17"]]);export{te as default};
