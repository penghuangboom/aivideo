import{d as vt,u as ht,b as ft,r as C,E as pt,p as F,q as Ue,z as gt,c as r,f,e as o,g as a,x as z,t as n,C as W,h as Z,v as de,G as Re,F as oe,B as ve,w as Ee,D as mt,k as yt,j as _t,A as he,n as k,s as bt,o as u,_ as Tt}from"./index-InSkuxQ1.js";import{g as be}from"./taskHistory-CM6jBMei.js";const St={class:"history-page"},Ct={key:0,class:"roadmap-banner tech-banner"},It={class:"banner-content"},$t={class:"banner-tag tech"},wt={class:"filter-section"},kt={class:"filter-header"},At={class:"filter-header-actions"},xt=["disabled"],Dt={class:"filter-content"},Lt={class:"filter-row"},Pt={class:"filter-item filter-date-range"},Ut={class:"date-inputs"},Rt=["placeholder"],Et=["placeholder"],Mt={class:"filter-item"},Nt=["placeholder"],Ot={class:"filter-item"},zt={value:""},Vt={value:"completed"},jt={value:"failed"},Ft={value:"processing"},Bt={value:"queued"},Gt={class:"filter-item filter-buttons-item"},qt={class:"filter-buttons"},Ht={key:0,class:"filter-result-info"},Kt={key:1,class:"batch-actions"},Yt={class:"batch-label"},Jt={class:"selected-count"},Qt={key:2,class:"data-load-status"},Wt={class:"load-status-row"},Xt={class:"load-status-info"},Zt={class:"status-text"},es={key:0,class:"more-hint"},ts={key:1,class:"all-loaded-hint"},ss={key:0,class:"load-actions"},os=["disabled"],ls={key:0},ns={key:1},as=["disabled"],is={key:0},rs={key:1},us={class:"table-container"},cs={class:"task-table"},ds={class:"checkbox-column"},vs=["checked","indeterminate","title"],hs={key:0},fs={key:1},ps={key:2},gs={key:3},ms={key:4},ys={key:5},_s={key:6},bs={key:7},Ts={key:8},Ss={key:9},Cs={key:10},Is={key:0},$s=["colspan"],ws={key:1},ks=["colspan"],As={class:"empty-state"},xs={class:"empty-text"},Ds={key:0,class:"empty-hint"},Ls=["disabled"],Ps={key:0},Us={key:1},Rs=["onMouseenter"],Es={class:"checkbox-column"},Ms=["disabled","checked","onMousedown","onMouseup","title"],Ns={key:0},Os={key:1},zs={key:2},Vs={key:3},js={key:4},Fs={key:5,class:"model-cell"},Bs={key:6},Gs={key:0,class:"fail-reason"},qs=["title"],Hs=["title"],Ks={key:9},Ys={class:"progress-bar"},Js={class:"progress-text"},Qs={key:10},Ws={class:"actions"},Xs=["onClick"],Zs={key:3,class:"pagination"},eo={class:"pagination-select-all"},to=["checked"],so={class:"select-label"},oo={class:"pagination-controls"},lo=["disabled"],no={class:"page-numbers"},ao=["onClick","disabled"],io=["disabled"],ro={class:"page-jump"},uo=["max","placeholder"],co={class:"page-info"},vo={class:"page-size-selector"},ho=["value"],fo={class:"modal-header"},po={class:"modal-body"},go={class:"modal-hint"},mo={class:"column-list"},yo=["onUpdate:modelValue","disabled"],_o={key:0,class:"fixed-tag"},bo={class:"modal-footer"},To=50,Me=50,So=vt({__name:"History",setup(Co){const{t:l,locale:Ne}=ht(),ie=ft(),w=C([]),Oe=C(new Set),fe=C(!1),le=C(!1),U=C(0),N=C(0),R=C(!1),D=C(!1),Te=C(!1),S=pt(new Set),K=C(0),ee=C(!1),pe=C(!1),B=C(null),L=C(1),G=C(100),ze=[20,100,200,500,1e3],re=C(0),Y=C(null),y=C({startDate:"",endDate:"",searchText:"",status:""}),O={INDEX:"index",SUBMITTED_AT:"submittedAt",FINISHED_AT:"finishedAt",DURATION:"duration",VIDEO_TYPE:"videoType",MODEL:"model",STATUS:"status",TASK_ID:"taskId",PROMPT:"prompt",PROGRESS:"progress",ACTIONS:"actions"},ge=F(()=>[{key:O.INDEX,label:l("history.columnIndexLabel"),fixed:!0},{key:O.SUBMITTED_AT,label:l("history.columnSubmittedAtLabel"),fixed:!1},{key:O.FINISHED_AT,label:l("history.columnFinishedAtLabel"),fixed:!1},{key:O.DURATION,label:l("history.columnDurationLabel"),fixed:!1},{key:O.VIDEO_TYPE,label:l("history.columnVideoTypeLabel"),fixed:!1},{key:O.MODEL,label:l("history.columnModelLabel"),fixed:!1},{key:O.STATUS,label:l("history.columnStatusLabel"),fixed:!0},{key:O.TASK_ID,label:l("history.columnTaskIdLabel"),fixed:!1},{key:O.PROMPT,label:l("history.columnPromptLabel"),fixed:!1},{key:O.PROGRESS,label:l("history.columnProgressLabel"),fixed:!1},{key:O.ACTIONS,label:l("history.columnActionsLabel"),fixed:!0}]),p=C({}),te=C(!1);async function ue(t=L.value,e=!1,c=!1){var d,_;console.log("ğŸ“– åŠ è½½ä»»åŠ¡åˆ—è¡¨...",`ç¬¬${t}é¡µ`,c?"(æ‰‹åŠ¨åˆ·æ–°)":e?"(åˆå§‹åŠ è½½)":"(è‡ªåŠ¨åˆ·æ–°)"),e&&(fe.value=!0),c&&(le.value=!0);try{console.log("ğŸ” å‡†å¤‡è¯·æ±‚ç¬¬ä¸€é¡µæ•°æ®...");const s=await he.getTaskList({p:1,page_size:100});if(console.log("ğŸ“‹ ========== ç¬¬ä¸€é¡µå“åº”è¯¦æƒ… =========="),console.log("ğŸ“‹ å®Œæ•´å“åº”å¯¹è±¡:",s),console.log("ğŸ“‹ å“åº”æ•°æ® (data):",s.data),console.log("ğŸ“‹ å“åº”æ•°æ®ç±»å‹:",typeof s.data),!((d=s==null?void 0:s.data)!=null&&d.items)||!Array.isArray(s.data.items)){console.error("âŒ æ— æ³•è·å–ä»»åŠ¡åˆ—è¡¨"),console.error("âŒ firstResponse.data:",s==null?void 0:s.data),w.value=[],re.value=0,U.value=0,N.value=0,R.value=!1;return}const m=s.data.total||0,I=s.data.page||1,E=s.data.page_size||100;if(re.value=m,console.log("ğŸ“‹ ========== åˆ†é¡µä¿¡æ¯ =========="),console.log("ğŸ“‹ åç«¯è¿”å›çš„ total:",m),console.log("ğŸ“‹ åç«¯è¿”å›çš„ page:",I),console.log("ğŸ“‹ åç«¯è¿”å›çš„ page_size:",E),console.log("ğŸ“‹ ç¬¬ä¸€é¡µå®é™…è¿”å›çš„è®°å½•æ•°:",s.data.items.length),console.log("ğŸ“‹ è®¡ç®—çš„æ€»é¡µæ•°:",Math.ceil(m/100)),m===0){w.value=[],U.value=0,N.value=0,R.value=!1;return}const A=Math.ceil(m/100);N.value=A,console.log("ğŸ“‹ æ€»ä»»åŠ¡æ•°:",m,"æ€»é¡µæ•°:",A);const b=Math.min(A,To);U.value=b,R.value=A>b,R.value?(console.log(`ğŸ“‹ é¦–æ¬¡åŠ è½½ ${b} é¡µï¼ˆ${b*100} æ¡è®°å½•ï¼‰ï¼Œæ€»å…± ${A} é¡µï¼ˆ${m} æ¡è®°å½•ï¼‰`),Te.value||(Te.value=!0,k.info(`å·²åŠ è½½æœ€è¿‘ ${b*100} æ¡è®°å½•ï¼Œå…± ${m} æ¡ã€‚å¯ç‚¹å‡»"åŠ è½½æ›´å¤š"æŸ¥çœ‹å†å²æ•°æ®`))):console.log(`ğŸ“‹ åŠ è½½å…¨éƒ¨ ${b} é¡µï¼ˆ${m} æ¡è®°å½•ï¼‰`);const Q=20,se=[],h=Math.ceil(b/Q);console.log(`ğŸ“‹ å¼€å§‹åˆ†æ‰¹åŠ è½½ ${b} é¡µæ•°æ®ï¼Œå…± ${h} æ‰¹...`);for(let v=0;v<h;v++){const T=v*Q+1,x=Math.min((v+1)*Q,b);console.log(`ğŸ“¦ åŠ è½½ç¬¬ ${v+1}/${h} æ‰¹ (ç¬¬${T}-${x}é¡µ)...`);const V=[];for(let X=T;X<=x;X++)V.push(he.getTaskList({p:X,page_size:100}));const j=await Promise.all(V);se.push(...j),console.log(`âœ… ç¬¬ ${v+1}/${h} æ‰¹åŠ è½½å®Œæˆ`)}const i=se;let g=[],$=0,M=0;for(let v=0;v<i.length;v++){const T=i[v];(_=T==null?void 0:T.data)!=null&&_.items&&Array.isArray(T.data.items)?(g=g.concat(T.data.items),$++,console.log(`âœ… ç¬¬ ${v+1} é¡µåŠ è½½æˆåŠŸï¼Œè·å– ${T.data.items.length} æ¡è®°å½•`)):(M++,console.error(`âŒ ç¬¬ ${v+1} é¡µåŠ è½½å¤±è´¥:`,T))}console.log(`ğŸ“‹ åŠ è½½å®Œæˆ: æˆåŠŸ ${$} é¡µï¼Œå¤±è´¥ ${M} é¡µï¼Œå…± ${g.length} æ¡è®°å½•`);const P=be();console.log("ğŸ“‹ æœ¬åœ°å­˜å‚¨çš„ä»»åŠ¡æ•°é‡:",P.length),w.value=g.map(v=>{var xe,De,Le,Pe;let T=0;v.progress?typeof v.progress=="string"?T=parseInt(v.progress.replace("%","")):T=v.progress:(xe=v.data)!=null&&xe.progress&&(T=v.data.progress);let x="unknown";v.status==="SUCCESS"?x="completed":v.status==="FAILURE"?x="failed":v.status==="NOT_START"?x="queued":v.status==="RUNNING"?x="processing":(De=v.data)!=null&&De.status&&(x=v.data.status);const V=v.action==="generate"?"image-to-video":"text-to-video",j=P.find(dt=>dt.taskId===v.task_id),X=(j==null?void 0:j.prompt)||void 0;return{id:v.id,taskId:v.task_id,type:"api",videoType:V,status:x,progress:T,submittedAt:v.submit_time?new Date(v.submit_time*1e3).toLocaleString():"-",finishedAt:v.finish_time?new Date(v.finish_time*1e3).toLocaleString():void 0,model:((Le=v.data)==null?void 0:Le.model)||"-",videoUrl:((Pe=v.data)==null?void 0:Pe.video_url)||v.fail_reason||void 0,failReason:v.status==="FAILURE"?v.fail_reason:void 0,prompt:X}}),console.log("âœ… æˆåŠŸåŠ è½½æ‰€æœ‰ä»»åŠ¡ï¼Œå…±",w.value.length,"æ¡")}catch(s){console.error("âŒ åŠ è½½ä»»åŠ¡å¤±è´¥:",s),console.error("âŒ é”™è¯¯è¯¦æƒ…:",s.message),w.value=[],re.value=0,U.value=0,N.value=0,R.value=!1}finally{e&&(fe.value=!1)}}async function Se(){var t;if(!(!R.value||D.value)){D.value=!0,console.log("ğŸ“– åŠ è½½æ›´å¤šä»»åŠ¡æ•°æ®...");try{const e=U.value,c=Math.min(Me,N.value-e),d=e+1,_=e+c;console.log(`ğŸ“‹ å½“å‰å·²åŠ è½½ ${e} é¡µï¼Œå‡†å¤‡åŠ è½½ç¬¬ ${d}-${_} é¡µ`);const s=20,m=[],I=Math.ceil(c/s);console.log(`ğŸ“‹ å¼€å§‹åˆ†æ‰¹åŠ è½½ ${c} é¡µæ•°æ®ï¼Œå…± ${I} æ‰¹...`);for(let h=0;h<I;h++){const i=d+h*s,g=Math.min(i+s-1,_);console.log(`ğŸ“¦ åŠ è½½ç¬¬ ${h+1}/${I} æ‰¹ (ç¬¬${i}-${g}é¡µ)...`);const $=[];for(let P=i;P<=g;P++)$.push(he.getTaskList({p:P,page_size:100}));const M=await Promise.all($);m.push(...M),console.log(`âœ… ç¬¬ ${h+1}/${I} æ‰¹åŠ è½½å®Œæˆ`)}let E=[],A=0,b=0;for(let h=0;h<m.length;h++){const i=m[h];(t=i==null?void 0:i.data)!=null&&t.items&&Array.isArray(i.data.items)?(E=E.concat(i.data.items),A++):(b++,console.error("âŒ é¡µé¢åŠ è½½å¤±è´¥:",i))}console.log(`ğŸ“‹ åŠ è½½å®Œæˆ: æˆåŠŸ ${A} é¡µï¼Œå¤±è´¥ ${b} é¡µï¼Œå…± ${E.length} æ¡æ–°è®°å½•`);const Q=be(),se=E.map(h=>{var v,T,x,V;let i=0;h.progress?typeof h.progress=="string"?i=parseInt(h.progress.replace("%","")):i=h.progress:(v=h.data)!=null&&v.progress&&(i=h.data.progress);let g="unknown";h.status==="SUCCESS"?g="completed":h.status==="FAILURE"?g="failed":h.status==="NOT_START"?g="queued":h.status==="RUNNING"?g="processing":(T=h.data)!=null&&T.status&&(g=h.data.status);const $=h.action==="generate"?"image-to-video":"text-to-video",M=Q.find(j=>j.taskId===h.task_id),P=(M==null?void 0:M.prompt)||void 0;return{id:h.id,taskId:h.task_id,type:"api",videoType:$,status:g,progress:i,submittedAt:h.submit_time?new Date(h.submit_time*1e3).toLocaleString():"-",finishedAt:h.finish_time?new Date(h.finish_time*1e3).toLocaleString():void 0,model:((x=h.data)==null?void 0:x.model)||"-",videoUrl:((V=h.data)==null?void 0:V.video_url)||h.fail_reason||void 0,failReason:h.status==="FAILURE"?h.fail_reason:void 0,prompt:P}});w.value=w.value.concat(se),U.value=_,R.value=_<N.value,console.log(`âœ… æˆåŠŸåŠ è½½æ›´å¤šä»»åŠ¡ï¼Œå½“å‰å…± ${w.value.length} æ¡è®°å½•`)}catch(e){console.error("âŒ åŠ è½½æ›´å¤šä»»åŠ¡å¤±è´¥:",e),k.error("åŠ è½½æ›´å¤šæ•°æ®å¤±è´¥")}finally{D.value=!1}}}async function Ve(){var c;if(!R.value||D.value)return;const t=N.value-U.value,e=t*100;if(!(e>1e4&&!await bt(`è¿˜æœ‰ ${e} æ¡è®°å½•æœªåŠ è½½ï¼Œä¸€æ¬¡æ€§åŠ è½½å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ`,"åŠ è½½å…¨éƒ¨æ•°æ®"))){D.value=!0,console.log(`ğŸ“– åŠ è½½å…¨éƒ¨å‰©ä½™ä»»åŠ¡æ•°æ®... (${t} é¡µ)`);try{const d=U.value,_=d+1,s=N.value;console.log(`ğŸ“‹ å½“å‰å·²åŠ è½½ ${d} é¡µï¼Œå‡†å¤‡åŠ è½½ç¬¬ ${_}-${s} é¡µï¼ˆå…± ${t} é¡µï¼‰`);const m=20,I=[],E=Math.ceil(t/m);console.log(`ğŸ“‹ å¼€å§‹åˆ†æ‰¹åŠ è½½ ${t} é¡µæ•°æ®ï¼Œå…± ${E} æ‰¹...`);for(let i=0;i<E;i++){const g=_+i*m,$=Math.min(g+m-1,s);console.log(`ğŸ“¦ åŠ è½½ç¬¬ ${i+1}/${E} æ‰¹ (ç¬¬${g}-${$}é¡µ)...`);const M=[];for(let v=g;v<=$;v++)M.push(he.getTaskList({p:v,page_size:100}));const P=await Promise.all(M);I.push(...P),console.log(`âœ… ç¬¬ ${i+1}/${E} æ‰¹åŠ è½½å®Œæˆ`)}let A=[],b=0,Q=0;for(let i=0;i<I.length;i++){const g=I[i];(c=g==null?void 0:g.data)!=null&&c.items&&Array.isArray(g.data.items)?(A=A.concat(g.data.items),b++):(Q++,console.error("âŒ é¡µé¢åŠ è½½å¤±è´¥:",g))}console.log(`ğŸ“‹ åŠ è½½å®Œæˆ: æˆåŠŸ ${b} é¡µï¼Œå¤±è´¥ ${Q} é¡µï¼Œå…± ${A.length} æ¡æ–°è®°å½•`);const se=be(),h=A.map(i=>{var T,x,V,j;let g=0;i.progress?typeof i.progress=="string"?g=parseInt(i.progress.replace("%","")):g=i.progress:(T=i.data)!=null&&T.progress&&(g=i.data.progress);let $="unknown";i.status==="SUCCESS"?$="completed":i.status==="FAILURE"?$="failed":i.status==="NOT_START"?$="queued":i.status==="RUNNING"?$="processing":(x=i.data)!=null&&x.status&&($=i.data.status);const M=i.action==="generate"?"image-to-video":"text-to-video",P=se.find(X=>X.taskId===i.task_id),v=(P==null?void 0:P.prompt)||void 0;return{id:i.id,taskId:i.task_id,type:"api",videoType:M,status:$,progress:g,submittedAt:i.submit_time?new Date(i.submit_time*1e3).toLocaleString():"-",finishedAt:i.finish_time?new Date(i.finish_time*1e3).toLocaleString():void 0,model:((V=i.data)==null?void 0:V.model)||"-",videoUrl:((j=i.data)==null?void 0:j.video_url)||i.fail_reason||void 0,failReason:i.status==="FAILURE"?i.fail_reason:void 0,prompt:v}});w.value=w.value.concat(h),U.value=s,R.value=!1,console.log(`âœ… æˆåŠŸåŠ è½½å…¨éƒ¨ä»»åŠ¡ï¼Œå½“å‰å…± ${w.value.length} æ¡è®°å½•`)}catch(d){console.error("âŒ åŠ è½½å…¨éƒ¨ä»»åŠ¡å¤±è´¥:",d),k.error("åŠ è½½å…¨éƒ¨æ•°æ®å¤±è´¥")}finally{D.value=!1}}}const ne=F(()=>{let t=w.value.filter(e=>!Oe.value.has(e.id));if(y.value.startDate){const e=new Date(y.value.startDate).getTime();t=t.filter(c=>new Date(c.submittedAt).getTime()>=e)}if(y.value.endDate){const e=new Date(y.value.endDate).getTime();t=t.filter(c=>new Date(c.submittedAt).getTime()<=e)}if(y.value.searchText.trim()){const e=y.value.searchText.toLowerCase();t=t.filter(c=>c.taskId.toLowerCase().includes(e)||(c.prompt||"").toLowerCase().includes(e))}return y.value.status&&(t=t.filter(e=>y.value.status==="processing"?e.status==="processing"||e.status==="in_progress":e.status===y.value.status)),t}),me=F(()=>ne.value.length),J=F(()=>Math.ceil(me.value/G.value)),q=F(()=>{const t=(L.value-1)*G.value,e=t+G.value;return ne.value.slice(t,e)}),Ce=F(()=>Object.values(p.value).filter(t=>t).length),je=F(()=>{const t=[],e=J.value,c=L.value;if(e<=7)for(let d=1;d<=e;d++)t.push(d);else if(c<=4){for(let d=1;d<=5;d++)t.push(d);t.push(-1),t.push(e)}else if(c>=e-3){t.push(1),t.push(-1);for(let d=e-4;d<=e;d++)t.push(d)}else{t.push(1),t.push(-1);for(let d=c-1;d<=c+1;d++)t.push(d);t.push(-1),t.push(e)}return t});function ce(t){t<1||t>J.value||t===-1||(L.value=t,window.scrollTo({top:0,behavior:"smooth"}))}function Ie(){if(Y.value===null||Y.value===void 0){k.warning("è¯·è¾“å…¥é¡µç ");return}const t=Y.value;if(t<1){k.warning("é¡µç ä¸èƒ½å°äº 1"),Y.value=1;return}if(t>J.value){k.warning(`é¡µç ä¸èƒ½å¤§äº ${J.value}`),Y.value=J.value;return}ce(t),Y.value=null}async function Fe(){console.log("ğŸ”„ æ‰‹åŠ¨åˆ·æ–°ä»»åŠ¡åˆ—è¡¨"),await ue(L.value,!0,!0),le.value=!1,k.success("å·²åˆ·æ–°ä»»åŠ¡åˆ—è¡¨")}function Be(){y.value={startDate:"",endDate:"",searchText:"",status:""},L.value=1,console.log("ğŸ”„ é‡ç½®ç­›é€‰æ¡ä»¶")}function Ge(){const t=localStorage.getItem("history-columns");if(t)try{p.value=JSON.parse(t)}catch(e){console.error("åŠ è½½åˆ—é…ç½®å¤±è´¥:",e),ye()}else ye()}function qe(){localStorage.setItem("history-columns",JSON.stringify(p.value)),te.value=!1,k.success("åˆ—è®¾ç½®å·²ä¿å­˜"),console.log("ğŸ’¾ ä¿å­˜åˆ—é…ç½®:",p.value)}function ye(){const t={};ge.value.forEach(e=>{t[e.key]=!0}),p.value=t,console.log("ğŸ”„ æ¢å¤é»˜è®¤åˆ—é…ç½®")}function $e(t){ge.value.forEach(e=>{e.fixed||(p.value[e.key]=t)}),console.log(t?"âœ… å…¨é€‰åˆ—":"âŒ å–æ¶ˆå…¨é€‰")}function He(t){return t&&{"text-to-video":l("history.videoTypeText"),"image-to-video":l("history.videoTypeImage")}[t]||"-"}function Ke(t){if(!t)return"-";const e=Ne.value;return e==="en-US"?t:e==="zh-CN"?t.replace(/landscape/g,"æ¨ªå±").replace(/portrait/g,"ç«–å±").replace(/hd/g,"é«˜æ¸…"):e==="zh-TW"?t.replace(/landscape/g,"æ©«å±").replace(/portrait/g,"è±å±").replace(/hd/g,"é«˜æ¸…"):t}function Ye(t){return{queued:l("history.statusQueued"),processing:l("history.statusProcessing"),in_progress:l("history.statusProcessing"),completed:l("history.statusCompleted"),failed:l("history.statusFailed")}[t]||t}function Je(t){var c;if(!t)return"";try{if(((c=JSON.parse(t).error)==null?void 0:c.code)==="too_many_concurrent_tasks")return"ä»»åŠ¡æ’é˜Ÿå¤±è´¥ï¼Œå·²é€€å›ï¼"}catch{}const e={"This content may violate our guardrails concerning similarity to third-party content.":"è¯¥å†…å®¹å¯èƒ½è¿åäº†æˆ‘ä»¬å…³äºä¸ç¬¬ä¸‰æ–¹å†…å®¹ç›¸ä¼¼æ€§çš„è§„å®šã€‚","This content may violate our guardrails concerning third-party likeness.":"æ­¤å†…å®¹å¯èƒ½è¿åæˆ‘ä»¬æœ‰å…³ç¬¬ä¸‰æ–¹è‚–åƒçš„ä¿æŠ¤è§„å®šã€‚","This content may violate our guardrails around nudity, sexuality, or erotic content.":"æ­¤å†…å®¹å¯èƒ½è¿åäº†æˆ‘ä»¬æœ‰å…³æ“¦è¾¹å†…å®¹çš„è§„å®šã€‚","It sounds like you're carrying a lot right now, but you don't have to go through this alone. You can find supportive resources [here](https://findahelpline.com)":"è¯·ä¸è¦å‘é€ä¸ç¬¦åˆä»·å€¼è§‚çš„æç¤ºè¯"};if(e[t])return e[t];for(const[d,_]of Object.entries(e))if(t.includes(d))return t.replace(d,_);return t}function Qe(t){return`status-${t}`}function we(t){return t?new Date(t).toLocaleString("zh-CN"):"-"}function We(t,e){if(!t||!e)return"-";const c=new Date(e).getTime()-new Date(t).getTime(),d=Math.floor(c/1e3);if(d<60)return`${d}ç§’`;const _=Math.floor(d/60),s=d%60;return`${_}åˆ†${s}ç§’`}function H(t){return t.status==="completed"&&!!t.videoUrl}function Xe(t){return K.value,S.has(t)}function ke(){const t=q.value.filter(H);_e.value?t.forEach(e=>{S.delete(e.taskId)}):t.forEach(e=>{S.add(e.taskId)}),K.value++}const _e=F(()=>{const t=q.value.filter(H);return t.length>0&&t.every(e=>S.has(e.taskId))}),Ze=F(()=>{const t=q.value.filter(H),e=t.filter(c=>S.has(c.taskId)).length;return e>0&&e<t.length}),et=F(()=>_e.value);function tt(){ke()}function st(){q.value.filter(H).forEach(e=>{S.has(e.taskId)?S.delete(e.taskId):S.add(e.taskId)}),K.value++}function ot(t,e){const c=q.value.find(d=>d.taskId===t);!c||!H(c)||(B.value=t,pe.value=!S.has(t))}function lt(t,e){const c=q.value.find(d=>d.taskId===t);if(!(!c||!H(c))){if(ee.value){ee.value=!1,B.value=null;return}S.has(t)?S.delete(t):S.add(t),B.value=null,K.value++}}function nt(t){if(!ee.value)if(B.value&&B.value!==t)ee.value=!0,pe.value?S.add(B.value):S.delete(B.value),K.value++;else return;const e=q.value.find(c=>c.taskId===t);!e||!H(e)||(pe.value?S.add(t):S.delete(t),K.value++)}function Ae(){ee.value&&(ee.value=!1),B.value&&(B.value=null)}function at(){S.clear(),K.value++}function it(){const t=w.value.filter(b=>S.has(b.taskId));if(t.length===0){k.warning(l("history.noTaskSelected"));return}const e=t.filter(b=>b.status==="completed"&&b.videoUrl);if(e.length===0){k.warning(l("history.noVideoInSelected"));return}const c=e.map(b=>b.videoUrl),d=c.join(`
`),_=new Blob([d],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(_),m=document.createElement("a");m.href=s;const I=new Date,E=I.toISOString().split("T")[0],A=I.toTimeString().split(" ")[0].replace(/:/g,"-");m.download=`video-urls-${E}-${A}.txt`,m.click(),URL.revokeObjectURL(s),e.length<t.length?k.info(l("history.partialDownload",{total:t.length,valid:e.length})):k.success(l("history.downloadSuccess",{count:c.length}))}function rt(){L.value=1,localStorage.setItem("history-page-size",String(G.value)),console.log("ğŸ“Š åˆ‡æ¢åˆ†é¡µå¤§å°:",G.value)}async function ut(t){if(!t.videoUrl){k.warning("è§†é¢‘é“¾æ¥ä¸å­˜åœ¨");return}let e=t.taskId;t.prompt&&t.prompt.trim()&&(e=t.prompt.trim().replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g,"_").substring(0,100)),console.log("ğŸ“¥ å¼€å§‹ä¸‹è½½è§†é¢‘:",t.videoUrl),console.log("ğŸ“ æ–‡ä»¶å:",e),k.info("æ­£åœ¨ä¸‹è½½è§†é¢‘ï¼Œè¯·ç¨å€™...");try{const c=await fetch(t.videoUrl);if(!c.ok)throw new Error(`ä¸‹è½½å¤±è´¥: ${c.status}`);const d=await c.blob(),_=URL.createObjectURL(d),s=document.createElement("a");s.href=_,s.download=`${e}.mp4`,document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>URL.revokeObjectURL(_),100),k.success("è§†é¢‘ä¸‹è½½æˆåŠŸï¼"),console.log("âœ… è§†é¢‘ä¸‹è½½å®Œæˆ:",e)}catch(c){console.error("âŒ ä¸‹è½½å¤±è´¥:",c),k.error("ä¸‹è½½å¤±è´¥ï¼š"+((c==null?void 0:c.message)||"æœªçŸ¥é”™è¯¯")),console.log("å°è¯•ç›´æ¥æ‰“å¼€é“¾æ¥..."),window.open(t.videoUrl,"_blank")}}let ae=null;function ct(){ae||(ae=window.setInterval(async()=>{console.log("ğŸ”„ è‡ªåŠ¨è½®è¯¢ä»»åŠ¡çŠ¶æ€..."),await ue();const t=w.value.filter(e=>e.status==="queued"||e.status==="processing"||e.status==="in_progress");console.log("ğŸ”„ è¿›è¡Œä¸­çš„ä»»åŠ¡æ•°é‡:",t.length),t.length===0&&ae&&(clearInterval(ae),ae=null,console.log("â¹ï¸ æ²¡æœ‰è¿›è¡Œä¸­çš„ä»»åŠ¡ï¼Œåœæ­¢è½®è¯¢"))},5e3))}return Ue(async()=>{console.log("ğŸš€ History é¡µé¢å·²æŒ‚è½½"),Ge();const t=localStorage.getItem("history-page-size");t&&(G.value=Number(t)),await ue(1,!0,!1),ct()}),document.addEventListener("visibilitychange",()=>{document.hidden||(console.log("ğŸ‘ï¸ é¡µé¢é‡æ–°å¯è§ï¼Œåˆ·æ–°ä»»åŠ¡åˆ—è¡¨"),ue())}),Ue(()=>{window.addEventListener("mouseup",Ae)}),gt(()=>{window.removeEventListener("mouseup",Ae)}),(t,e)=>{var c,d,_;return u(),r("div",St,[a(ie).config.features.enableBanner?(u(),r("div",Ct,[e[15]||(e[15]=o("div",{class:"banner-icon"},"âš¡",-1)),o("div",It,[o("strong",null,n(((c=a(ie).config.features.bannerConfig)==null?void 0:c.title)||a(l)("history.banner")),1),z(" "+n(((d=a(ie).config.features.bannerConfig)==null?void 0:d.description)||a(l)("history.bannerDesc")),1)]),o("div",$t,n(((_=a(ie).config.features.bannerConfig)==null?void 0:_.tag)||a(l)("history.bannerTag")),1)])):f("",!0),o("div",wt,[o("div",kt,[o("h3",null,n(a(l)("history.filterTitle")),1),o("div",At,[o("button",{onClick:Fe,class:W(["refresh-btn",{refreshing:le.value}]),disabled:le.value},[e[16]||(e[16]=o("span",{class:"refresh-icon"},"ğŸ”„",-1)),z(" "+n(le.value?a(l)("history.refreshing"):a(l)("history.refreshButton")),1)],10,xt)])]),o("div",Dt,[o("div",Lt,[o("div",Pt,[o("label",null,n(a(l)("history.timeRange")),1),o("div",Ut,[Z(o("input",{type:"datetime-local","onUpdate:modelValue":e[0]||(e[0]=s=>y.value.startDate=s),placeholder:a(l)("history.startTime")},null,8,Rt),[[de,y.value.startDate]]),e[17]||(e[17]=o("span",{class:"date-separator"},"~",-1)),Z(o("input",{type:"datetime-local","onUpdate:modelValue":e[1]||(e[1]=s=>y.value.endDate=s),placeholder:a(l)("history.endTime")},null,8,Et),[[de,y.value.endDate]])])]),o("div",Mt,[o("label",null,n(a(l)("history.search")),1),Z(o("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=s=>y.value.searchText=s),placeholder:a(l)("history.searchPlaceholder")},null,8,Nt),[[de,y.value.searchText]])]),o("div",Ot,[o("label",null,n(a(l)("history.taskStatus")),1),Z(o("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>y.value.status=s)},[o("option",zt,n(a(l)("history.statusAll")),1),o("option",Vt,n(a(l)("history.statusCompleted")),1),o("option",jt,n(a(l)("history.statusFailed")),1),o("option",Ft,n(a(l)("history.statusProcessing")),1),o("option",Bt,n(a(l)("history.statusQueued")),1)],512),[[Re,y.value.status]])]),o("div",Gt,[e[20]||(e[20]=o("label",null,"Â ",-1)),o("div",qt,[o("button",{onClick:Be,class:"btn-secondary"},[e[18]||(e[18]=o("span",null,"ğŸ”„",-1)),z(" "+n(a(l)("history.resetButton")),1)]),o("button",{onClick:e[4]||(e[4]=s=>te.value=!0),class:"btn-secondary"},[e[19]||(e[19]=o("span",null,"âš™ï¸",-1)),z(" "+n(a(l)("history.columnSettings")),1)])])])]),ne.value.length!==w.value.length?(u(),r("div",Ht,[z(n(a(l)("history.filterResult"))+" ",1),o("strong",null,n(ne.value.length),1),z(" "+n(a(l)("history.filterResultRecords")),1)])):f("",!0)])]),S.size>0?(u(),r("div",Kt,[o("span",Yt,n(a(l)("history.batchActions"))+"ï¼š",1),o("span",Jt,n(a(l)("history.selectedCount",{count:S.size})),1),o("button",{onClick:it,class:"batch-btn primary"},n(a(l)("history.downloadVideoUrls")),1),o("button",{onClick:at,class:"batch-btn secondary"},n(a(l)("history.clearSelection")),1)])):f("",!0),R.value?(u(),r("div",Qt,[o("div",Wt,[o("div",Xt,[e[24]||(e[24]=o("span",{class:"status-icon"},"ğŸ“Š",-1)),o("span",Zt,[e[21]||(e[21]=z(" å·²åŠ è½½ ",-1)),o("strong",null,n(U.value*100),1),e[22]||(e[22]=z(" æ¡è®°å½•ï¼Œå…± ",-1)),o("strong",null,n(re.value),1),e[23]||(e[23]=z(" æ¡ ",-1)),R.value?(u(),r("span",es,"ï¼ˆè¿˜æœ‰ "+n((N.value-U.value)*100)+" æ¡æœªåŠ è½½ï¼‰",1)):(u(),r("span",ts,"âœ… å·²åŠ è½½å…¨éƒ¨æ•°æ®"))])]),R.value?(u(),r("div",ss,[o("button",{onClick:Se,class:W(["load-btn load-more",{loading:D.value}]),disabled:D.value},[D.value?(u(),r("span",ns,"â³ åŠ è½½ä¸­...")):(u(),r("span",ls,"â¬‡ï¸ åŠ è½½æ›´å¤š ("+n(Math.min(Me*100,(N.value-U.value)*100))+" æ¡)",1))],10,os),o("button",{onClick:Ve,class:W(["load-btn load-all",{loading:D.value}]),disabled:D.value},[D.value?(u(),r("span",rs,"â³ åŠ è½½ä¸­...")):(u(),r("span",is,"ğŸ“¥ åŠ è½½å…¨éƒ¨ ("+n((N.value-U.value)*100)+" æ¡)",1))],10,as)])):f("",!0)])])):f("",!0),o("div",us,[o("table",cs,[o("thead",null,[o("tr",null,[o("th",ds,[o("input",{type:"checkbox",class:"task-checkbox",checked:_e.value,indeterminate:Ze.value,onChange:ke,title:a(l)("history.selectAllPage")},null,40,vs)]),p.value.index?(u(),r("th",hs,n(a(l)("history.columnIndex")),1)):f("",!0),p.value.submittedAt?(u(),r("th",fs,n(a(l)("history.columnSubmittedAt")),1)):f("",!0),p.value.finishedAt?(u(),r("th",ps,n(a(l)("history.columnFinishedAt")),1)):f("",!0),p.value.duration?(u(),r("th",gs,n(a(l)("history.columnDuration")),1)):f("",!0),p.value.videoType?(u(),r("th",ms,n(a(l)("history.columnVideoType")),1)):f("",!0),p.value.model?(u(),r("th",ys,n(a(l)("history.columnModel")),1)):f("",!0),p.value.status?(u(),r("th",_s,n(a(l)("history.columnStatus")),1)):f("",!0),p.value.taskId?(u(),r("th",bs,n(a(l)("history.columnTaskId")),1)):f("",!0),p.value.prompt?(u(),r("th",Ts,n(a(l)("history.columnPrompt")),1)):f("",!0),p.value.progress?(u(),r("th",Ss,n(a(l)("history.columnProgress")),1)):f("",!0),p.value.actions?(u(),r("th",Cs,n(a(l)("history.columnActions")),1)):f("",!0)])]),o("tbody",null,[fe.value?(u(),r("tr",Is,[o("td",{colspan:Ce.value+1,class:"loading"},[e[25]||(e[25]=o("div",{class:"loading-spinner"},"â³",-1)),o("div",null,n(a(l)("history.loading")),1)],8,$s)])):q.value.length===0?(u(),r("tr",ws,[o("td",{colspan:Ce.value+1,class:"empty"},[o("div",As,[e[26]||(e[26]=o("div",{class:"empty-icon"},"ğŸ“­",-1)),o("div",xs,[y.value.searchText||y.value.status||y.value.startDate||y.value.endDate?(u(),r(oe,{key:0},[z(" åœ¨å·²åŠ è½½çš„ "+n(w.value.length)+" æ¡è®°å½•ä¸­æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ä»»åŠ¡ ",1)],64)):(u(),r(oe,{key:1},[z(n(a(l)("history.noTasks")),1)],64))]),R.value&&(y.value.searchText||y.value.status||y.value.startDate||y.value.endDate)?(u(),r("div",Ds,[o("button",{onClick:Se,class:"hint-btn",disabled:D.value},[D.value?(u(),r("span",Us,"â³ åŠ è½½ä¸­...")):(u(),r("span",Ps,"ğŸ’¡ åŠ è½½æ›´å¤šå†å²æ•°æ®å†æœç´¢"))],8,Ls)])):f("",!0)])],8,ks)])):(u(!0),r(oe,{key:2},ve(q.value,(s,m)=>(u(),r("tr",{key:s.id,class:W(Qe(s.status)),onMouseenter:I=>nt(s.taskId)},[o("td",Es,[(u(),r("input",{type:"checkbox",class:"task-checkbox",key:`checkbox-${s.taskId}-${K.value}`,disabled:!H(s),checked:Xe(s.taskId),onMousedown:Ee(I=>ot(s.taskId),["prevent"]),onMouseup:I=>lt(s.taskId),title:H(s)?a(l)("history.selectThisTask"):a(l)("history.taskNotCompleted")},null,40,Ms))]),p.value.index?(u(),r("td",Ns,n(ne.value.length-(L.value-1)*G.value-m),1)):f("",!0),p.value.submittedAt?(u(),r("td",Os,n(we(s.submittedAt)),1)):f("",!0),p.value.finishedAt?(u(),r("td",zs,n(s.finishedAt?we(s.finishedAt):"-"),1)):f("",!0),p.value.duration?(u(),r("td",Vs,n(We(s.submittedAt,s.finishedAt)),1)):f("",!0),p.value.videoType?(u(),r("td",js,[o("span",{class:W(["video-type-badge",s.videoType])},n(He(s.videoType)),3)])):f("",!0),p.value.model?(u(),r("td",Fs,n(Ke(s.model)||"-"),1)):f("",!0),p.value.status?(u(),r("td",Bs,[o("span",{class:W(["status-badge",s.status])},n(Ye(s.status)),3),s.failReason&&s.status==="failed"?(u(),r("div",Gs,n(Je(s.failReason)),1)):f("",!0)])):f("",!0),p.value.taskId?(u(),r("td",{key:7,class:"task-id-cell",title:s.taskId},n(s.taskId),9,qs)):f("",!0),p.value.prompt?(u(),r("td",{key:8,class:"prompt-cell",title:s.prompt||"æ— "},n(s.prompt?s.prompt.length>50?s.prompt.slice(0,50)+"...":s.prompt:"-"),9,Hs)):f("",!0),p.value.progress?(u(),r("td",Ks,[o("div",Ys,[o("div",{class:"progress-fill",style:mt({width:s.progress+"%"})},null,4),o("span",Js,n(s.progress)+"%",1)])])):f("",!0),p.value.actions?(u(),r("td",Qs,[o("div",Ws,[s.status==="completed"&&s.videoUrl?(u(),r("button",{key:0,onClick:I=>ut(s),class:"action-btn download",title:"ä¸‹è½½è§†é¢‘"}," â¬‡ï¸ ",8,Xs)):f("",!0)])])):f("",!0)],42,Rs))),128))])])]),me.value>0?(u(),r("div",Zs,[o("div",eo,[o("input",{type:"checkbox",checked:et.value,onChange:tt,class:"select-checkbox"},null,40,to),o("span",so,n(a(l)("history.selectAll")),1),o("button",{onClick:st,class:"invert-btn"},n(a(l)("history.invertSelection")),1)]),o("div",oo,[o("button",{onClick:e[5]||(e[5]=s=>ce(L.value-1)),disabled:L.value===1,class:"page-btn"}," â† "+n(a(l)("history.prevPage")),9,lo),o("div",no,[(u(!0),r(oe,null,ve(je.value,(s,m)=>(u(),r("button",{key:s===-1?`ellipsis-${m}`:s,onClick:I=>ce(s),class:W(["page-number",{active:s===L.value,ellipsis:s===-1}]),disabled:s===-1},n(s===-1?"...":s),11,ao))),128))]),o("button",{onClick:e[6]||(e[6]=s=>ce(L.value+1)),disabled:L.value===J.value,class:"page-btn"},n(a(l)("history.nextPage"))+" â†’ ",9,io),o("div",ro,[o("span",null,n(a(l)("history.jumpTo")),1),Z(o("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=s=>Y.value=s),onKeyup:yt(Ie,["enter"]),min:1,max:J.value,class:"page-jump-input",placeholder:a(l)("history.pageNumber")},null,40,uo),[[de,Y.value,void 0,{number:!0}]]),o("button",{onClick:Ie,class:"page-btn"},n(a(l)("history.jump")),1)]),o("div",co,n(a(l)("history.pageInfo",{current:L.value,total:J.value,count:me.value})),1)]),o("div",vo,[o("label",null,n(a(l)("history.pageSize"))+"ï¼š",1),Z(o("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>G.value=s),onChange:rt,class:"page-size-select"},[(u(),r(oe,null,ve(ze,s=>o("option",{key:s,value:s},n(s),9,ho)),64))],544),[[Re,G.value,void 0,{number:!0}]])])])):f("",!0),te.value?(u(),r("div",{key:4,class:"modal-overlay",onClick:e[14]||(e[14]=s=>te.value=!1)},[o("div",{class:"modal-content",onClick:e[13]||(e[13]=Ee(()=>{},["stop"]))},[o("div",fo,[o("h3",null,"âš™ï¸ "+n(a(l)("history.columnSettingsTitle")),1),o("button",{class:"modal-close",onClick:e[9]||(e[9]=s=>te.value=!1)},"Ã—")]),o("div",po,[o("p",go,n(a(l)("history.columnSettingsHint")),1),o("div",mo,[(u(!0),r(oe,null,ve(ge.value,s=>(u(),r("label",{key:s.key,class:W(["column-item",{disabled:s.fixed}])},[Z(o("input",{type:"checkbox","onUpdate:modelValue":m=>p.value[s.key]=m,disabled:s.fixed},null,8,yo),[[_t,p.value[s.key]]]),o("span",null,n(s.label),1),s.fixed?(u(),r("span",_o,n(a(l)("history.fixedTag")),1)):f("",!0)],2))),128))])]),o("div",bo,[o("button",{onClick:e[10]||(e[10]=s=>$e(!0)),class:"btn-secondary"},n(a(l)("history.selectAll")),1),o("button",{onClick:e[11]||(e[11]=s=>$e(!1)),class:"btn-secondary"},n(a(l)("history.invertSelection")),1),o("button",{onClick:ye,class:"btn-secondary"},n(a(l)("history.resetDefault")),1),e[27]||(e[27]=o("div",{class:"spacer"},null,-1)),o("button",{onClick:e[12]||(e[12]=s=>te.value=!1),class:"btn-secondary"},n(a(l)("history.cancel")),1),o("button",{onClick:qe,class:"btn-primary"},n(a(l)("history.confirm")),1)])])])):f("",!0)])}}}),wo=Tt(So,[["__scopeId","data-v-69c5626f"]]);export{wo as default};
