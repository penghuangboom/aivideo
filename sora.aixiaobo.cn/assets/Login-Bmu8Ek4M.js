import{d as K,u as O,a as X,b as q,r as m,c as p,e as o,f as z,g as a,t as l,w,h as E,v as L,i as Q,j as W,k as Y,l as V,A as $,m as Z,s as ee,n as D,o as h,_ as oe}from"./index-InSkuxQ1.js";const se={class:"login-container"},te={class:"login-card card glass"},ae={class:"login-header"},ne=["src","alt"],le={class:"gradient-text"},ie={class:"platform-desc"},ce={class:"form-group"},re=["placeholder","disabled"],de={class:"form-group"},ue={class:"password-input-wrapper"},ge=["placeholder","type","disabled"],me=["disabled"],pe={key:0},he={key:1},ve={class:"remember-me"},fe={class:"checkbox-label"},_e=["disabled"],we=["disabled"],be={key:0},ke={key:1},ye={class:"links"},Ce={class:"modal-header"},Te={class:"modal-body"},Se={class:"modal-desc"},xe={class:"form-group"},Ee=["placeholder","disabled"],Ie=["disabled"],Me={key:0},Pe={key:1},$e=K({__name:"Login",setup(De){const{t:s}=O(),b=Z(),k=X(),f=q(),y=m(""),C=m(""),I=m(!0),d=m(!1),T=m(!1),M=m(!1),u=m(""),_=m(!1);async function U(){var i,t;if(!y.value||!C.value){g(s("login.pleaseEnterCredentials"));return}d.value=!0;try{console.log("æ¸…é™¤æ—§çš„ç”¨æˆ·ID..."),localStorage.removeItem("new-api-user"),sessionStorage.removeItem("new-api-user");const e=await V.post("/api/user/login",{username:y.value,password:C.value},{headers:{"X-Show-Error":"true"}}).then(r=>r.data);if(!e.success){g(e.message||s("login.loginFailed"));return}if(console.log("ç™»å½•æˆåŠŸï¼Œå“åº”æ•°æ®:",e),!e.data||!e.data.id){g(s("login.loginFailed")+"ï¼šæœªè·å–åˆ°ç”¨æˆ·ID");return}const c=String(e.data.id);localStorage.setItem("new-api-user",c),console.log("âœ… ä»ç™»å½•å“åº”ä¿å­˜ç”¨æˆ·ID:",c),console.log("æ­£åœ¨è·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯...");const n=await $.getUserSelf();if(!n.success||!n.data){g("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥");return}console.log("è·å–åˆ°å®Œæ•´ç”¨æˆ·ä¿¡æ¯:",n.data),k.setProfile(n.data,I.value);try{const r=await $.getAffCode();r.success&&r.data&&k.setAffCode(r.data)}catch(r){console.warn("è·å–é‚€è¯·ç å¤±è´¥",r)}if(f.config.balanceLimit.minBalance===0){console.log("âœ… ä½™é¢é™åˆ¶ä¸º0ï¼Œç›´æ¥è·³è½¬åˆ°ä¸»é¡µ"),S(s("login.loginSuccess")),setTimeout(()=>{b.push("/generate")},500);return}if(!k.hasLoginPermission){console.log("âš ï¸ ç´¯è®¡å……å€¼ä¸è¶³ä¸”ä¸æ˜¯VIP/SVIPï¼Œè·³è½¬åˆ°å……å€¼é¡µé¢"),S(s("login.loginSuccess")),setTimeout(()=>{b.push("/redeem-standalone")},500);return}S(s("login.loginSuccess")),setTimeout(()=>{b.push("/generate")},500)}catch(e){const c=((t=(i=e==null?void 0:e.response)==null?void 0:i.data)==null?void 0:t.message)||(e==null?void 0:e.message);c&&!c.includes("è¯·æ±‚å¤±è´¥")&&g(c),console.error("ç™»å½•å¤±è´¥:",e)}finally{d.value=!1}}function N(){M.value=!0,u.value=""}function P(){M.value=!1,u.value=""}async function B(){var i,t;if(!u.value||!/.+@.+\..+/.test(u.value)){g(s("login.invalidEmail"));return}_.value=!0;try{const e=await V.get(`/api/reset_password?email=${encodeURIComponent(u.value)}&turnstile=`,{headers:{"X-Show-Error":"true"}}).then(c=>c.data);e.success?(S(s("login.resetLinkSent")),P()):g(e.message||s("login.sendFailed"))}catch(e){const c=((t=(i=e==null?void 0:e.response)==null?void 0:i.data)==null?void 0:t.message)||(e==null?void 0:e.message)||s("login.sendFailed");g(c)}finally{_.value=!1}}function g(i){const t=document.createElement("div");t.className="api-error-notification",t.innerHTML=`
    <div class="error-icon">âŒ</div>
    <div class="error-content">
      <div class="error-title">${s("notification.operationFailed")}</div>
      <div class="error-message">${i}</div>
    </div>
    <button class="error-close" onclick="this.parentElement.remove()">âœ•</button>
  `,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>t.remove(),300)},5e3)}function S(i){const t=document.createElement("div");t.className="api-error-notification success",t.innerHTML=`
    <div class="error-icon">âœ…</div>
    <div class="error-content">
      <div class="error-title">${s("notification.operationSuccess")}</div>
      <div class="error-message">${i}</div>
    </div>
    <button class="error-close" onclick="this.parentElement.remove()">âœ•</button>
  `,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>t.remove(),300)},5e3)}function G(){b.push("/register")}async function J(){const i=s("login.clearAllCacheMessage");if(await ee(i,s("login.clearAllCacheConfirm")))try{D.info(s("app.clearingCache"),s("notification.clearCache")),console.log("ğŸ—‘ï¸ è°ƒç”¨åç«¯æ¸…é™¤ç¼“å­˜æ¥å£...");try{await $.clearAllCache(),console.log("âœ… åç«¯ç¼“å­˜æ¸…é™¤æˆåŠŸ")}catch(n){console.log("âš ï¸ åç«¯æ¥å£è°ƒç”¨å¤±è´¥ï¼Œç»§ç»­å‰ç«¯æ¸…é™¤:",n)}console.log("ğŸ—‘ï¸ å¼€å§‹æ¸…é™¤ç¼“å­˜...");const e=document.cookie.split(";");console.log("ğŸ“‹ å½“å‰Cookie:",document.cookie);for(let n=0;n<e.length;n++){const v=e[n],r=v.indexOf("="),x=r>-1?v.substring(0,r).trim():v.trim();if(x){console.log("ğŸ—‘ï¸ åˆ é™¤Cookie:",x);const j=["/","/login","/api"],A=[window.location.hostname,"."+window.location.hostname,window.location.host],F=window.location.hostname.split(".");F.length>2&&A.push("."+F.slice(-2).join(".")),j.forEach(R=>{document.cookie=`${x}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=${R}`,A.forEach(H=>{document.cookie=`${x}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=${R};domain=${H}`})})}}["session","SITE_TOTAL_ID","token","auth_token","user_id"].forEach(n=>{document.cookie=`${n}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`,document.cookie=`${n}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=${window.location.hostname}`,document.cookie=`${n}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.${window.location.hostname}`}),console.log("ğŸ—‘ï¸ æ¸…é™¤ localStorage"),localStorage.clear(),console.log("ğŸ—‘ï¸ æ¸…é™¤ sessionStorage"),sessionStorage.clear(),console.log("ğŸ—‘ï¸ æ¸…é™¤ auth store"),k.logout(),window.indexedDB&&(console.log("ğŸ—‘ï¸ æ¸…é™¤ IndexedDB"),indexedDB.databases().then(n=>{n.forEach(v=>{v.name&&indexedDB.deleteDatabase(v.name)})}).catch(n=>console.log("IndexedDBæ¸…é™¤å¤±è´¥:",n))),console.log("âœ… ç¼“å­˜æ¸…é™¤å®Œæˆ"),console.log("ğŸ“‹ æ¸…é™¤åCookie:",document.cookie),D.success(s("app.cacheCleared"),s("notification.clearSuccess")),setTimeout(()=>{window.location.replace("/#/login")},1500)}catch(e){console.error("âŒ æ¸…é™¤ç¼“å­˜å¤±è´¥:",e),D.error(s("app.clearCacheFailed"),s("notification.clearFailed"))}}return(i,t)=>(h(),p("div",se,[t[6]||(t[6]=o("div",{class:"bg-orbs"},[o("div",{class:"orb orb-1"}),o("div",{class:"orb orb-2"}),o("div",{class:"orb orb-3"})],-1)),o("div",te,[o("div",ae,[o("img",{src:a(f).config.logoUrl,alt:a(f).config.systemName,class:"logo glow"},null,8,ne),o("h2",le,l(a(f).config.systemName),1),o("p",ie,l(a(f).config.description),1)]),o("form",{onSubmit:w(U,["prevent"]),class:"login-form"},[o("div",ce,[o("label",null,l(a(s)("login.username")),1),E(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),placeholder:a(s)("login.usernamePlaceholder"),autocomplete:"username",disabled:d.value},null,8,re),[[L,y.value,void 0,{trim:!0}]])]),o("div",de,[o("label",null,l(a(s)("login.password")),1),o("div",ue,[E(o("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>C.value=e),placeholder:a(s)("login.passwordPlaceholder"),type:T.value?"text":"password",autocomplete:"current-password",disabled:d.value},null,8,ge),[[Q,C.value,void 0,{trim:!0}]]),o("button",{type:"button",class:"password-toggle",onClick:t[2]||(t[2]=e=>T.value=!T.value),disabled:d.value,tabindex:"-1"},[T.value?(h(),p("span",pe,"ğŸ‘ï¸")):(h(),p("span",he,"ğŸ‘ï¸â€ğŸ—¨ï¸"))],8,me)])]),o("div",ve,[o("label",fe,[E(o("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>I.value=e),disabled:d.value},null,8,_e),[[W,I.value]]),o("span",null,l(a(s)("login.rememberMe")),1)]),o("a",{onClick:w(N,["prevent"]),class:"forgot-password-link"},l(a(s)("login.forgotPassword")),1)]),o("button",{type:"submit",disabled:d.value,class:"btn-primary btn-large"},[d.value?(h(),p("span",ke,l(a(s)("login.loggingIn")),1)):(h(),p("span",be,l(a(s)("login.loginButton")),1))],8,we)],32),o("div",ye,[o("a",{onClick:w(G,["prevent"])},l(a(s)("login.goToRegister")),1),o("a",{onClick:w(J,["prevent"]),class:"clear-cache-link"},l(a(s)("login.clearCache")),1)])]),M.value?(h(),p("div",{key:0,class:"modal-overlay",onClick:P},[o("div",{class:"modal-content",onClick:t[5]||(t[5]=w(()=>{},["stop"]))},[o("div",Ce,[o("h3",null,l(a(s)("login.resetPassword")),1),o("button",{class:"modal-close",onClick:P},"âœ•")]),o("div",Te,[o("p",Se,l(a(s)("login.resetPasswordDesc")),1),o("div",xe,[o("label",null,l(a(s)("login.emailAddress")),1),E(o("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>u.value=e),type:"email",placeholder:a(s)("login.emailPlaceholder"),disabled:_.value,onKeyup:Y(B,["enter"])},null,40,Ee),[[L,u.value,void 0,{trim:!0}]])]),o("button",{onClick:B,disabled:_.value||!u.value,class:"btn-primary btn-large"},[_.value?(h(),p("span",Pe,l(a(s)("login.sending")),1)):(h(),p("span",Me,l(a(s)("login.sendResetLink")),1))],8,Ie)])])])):z("",!0)]))}}),Ae=oe($e,[["__scopeId","data-v-b4cac034"]]);export{Ae as default};
