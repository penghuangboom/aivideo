import{d as Q,u as V,a as O,b as z,r as I,c as y,e as t,f as w,t as r,g as a,w as L,h as J,v as W,x as N,A as T,n as d,m as Y,s as K,o as S,_ as j}from"./index-InSkuxQ1.js";const G={class:"standalone-redeem-page"},H={class:"redeem-container"},X={class:"header"},Z={class:"title"},ee={class:"card"},te={class:"balance-section"},se={class:"balance-label"},ae={class:"balance-value"},oe={key:0,class:"balance-tip"},re={class:"form-group"},le={for:"redemptionCode"},ne=["placeholder","disabled"],ce={key:0,class:"error-message"},ue={class:"button-group"},ie=["disabled"],de={class:"info-section"},me={key:0},pe={class:"actions"},ge={class:"modal-message"},fe={class:"modal-balance"},ve=Q({__name:"RedeemCodeStandalone",setup(_e){const{t:e,locale:M}=V(),q=Y(),l=O(),g=z(),p=I(""),B=I(!1),n=I(""),C=I(!1),k=I(0);function F(o){return o.toFixed(2).replace(/\.?0+$/,"")}const U=o=>{if(o==null)return"-";const c=localStorage.getItem("quota_per_unit");let m=localStorage.getItem("quota_display_type")||"USD";const f=c?parseFloat(c):5e5;if(localStorage.getItem("quota_display_type")||(m=M.value==="zh-CN"||M.value==="zh-TW"?"CNY":"USD"),m==="TOKENS")return o.toString();const i=o/f;let v="$",s=i;if(m==="CNY"){const u=localStorage.getItem("status");let h=7.3;try{if(u){const _=JSON.parse(u);h=(_==null?void 0:_.usd_exchange_rate)||h}}catch{}s=i*h,v="Â¥"}else if(m==="CUSTOM"){const u=localStorage.getItem("status");let h="Â¤",_=1;try{if(u){const b=JSON.parse(u);h=(b==null?void 0:b.custom_currency_symbol)||h,_=(b==null?void 0:b.custom_currency_exchange_rate)||_}}catch{}s=i*_,v=h}return v+F(s)},D=async()=>{var o,c,m,f;if(!p.value.trim()){n.value=e("redeem.pleaseEnterCode");return}n.value="",B.value=!0;try{const i=localStorage.getItem("new-api-user");if(!i){console.warn("æœªæ‰¾åˆ° API ç”¨æˆ·IDï¼Œä½¿ç”¨åŽŸå§‹å…‘æ¢æŽ¥å£");const s=await T.redeemCode(p.value.trim());s.success?(k.value=s.data,l.profile&&(l.profile.quota=(l.profile.quota||0)+s.data),C.value=!0,p.value="",d.success(e("redeem.successTitle"))):(n.value=s.message||e("redeem.redeemFailedMessage"),d.error(n.value));return}const v=g.config.agentId;if(!v){console.warn("âš ï¸ æœªæ‰¾åˆ°ä»£ç†å•†IDï¼Œå›žé€€åˆ°ç®€å•å…‘æ¢æŽ¥å£ï¼ˆæ— ä»£ç†å•†ä½“ç³»ï¼‰");const s=await T.redeemCode(p.value.trim());s.success?(k.value=s.data,l.profile&&(l.profile.quota=(l.profile.quota||0)+s.data),C.value=!0,p.value="",d.success(e("redeem.successTitle"))):(n.value=s.message||e("redeem.redeemFailedMessage"),d.error(n.value));return}try{const s=await T.redeemCodeWithUpgrade(p.value.trim(),parseInt(i),v);s.success&&s.data?(k.value=s.data.quota,l.profile&&(l.profile.quota=(l.profile.quota||0)+s.data.quota,s.data.upgraded&&s.data.new_group&&(l.profile.group=s.data.new_group,console.log(`âœ… ç”¨æˆ·ç­‰çº§å·²å‡çº§ï¼š${s.data.old_group} â†’ ${s.data.new_group}`))),C.value=!0,p.value="",s.data.upgraded?d.success(`${e("redeem.successTitle")}
ðŸŽ‰ ${s.message}`):d.success(e("redeem.successTitle"))):(n.value=s.message||e("redeem.redeemFailedMessage"),d.error(n.value))}catch(s){console.warn("âš ï¸ è‡ªåŠ¨å‡çº§æŽ¥å£è°ƒç”¨å¤±è´¥ï¼Œå›žé€€åˆ°åŽŸå§‹å……å€¼æŽ¥å£:",((c=(o=s.response)==null?void 0:o.data)==null?void 0:c.detail)||s.message);try{const u=await T.redeemCode(p.value.trim());u.success?(k.value=u.data,l.profile&&(l.profile.quota=(l.profile.quota||0)+u.data),C.value=!0,p.value="",d.success(e("redeem.successTitle"))):(n.value=u.message||e("redeem.redeemFailedMessage"),d.error(n.value))}catch(u){console.error("å…‘æ¢å¤±è´¥:",u),(f=(m=u.response)==null?void 0:m.data)!=null&&f.message?n.value=u.response.data.message:u.message?n.value=u.message:n.value=e("redeem.redeemFailedRetry"),d.error(n.value)}}}catch(i){console.error("å……å€¼å¤„ç†å¼‚å¸¸:",i),n.value=i.message||e("redeem.redeemFailedRetry"),d.error(n.value)}finally{B.value=!1}},x=()=>{if(C.value=!1,l.hasLoginPermission)q.push("/generate"),d.success(e("redeem.rechargeSuccess"));else{const o=g.config.balanceLimit.displayBalance;d.warning(e("redeem.balanceStillLow",{amount:o}))}},R=()=>{x()},A=()=>{var v,s;const o=g.config.balanceLimit.minBalance;if(o===0)return!0;const c=((v=l.profile)==null?void 0:v.quota)||0,m=((s=l.profile)==null?void 0:s.used_quota)||0,f=c+m,i=f*.146/1e4;return console.log("ðŸ” shouldShowLaterButton æ£€æŸ¥:",{å‰©ä½™é¢åº¦:c,å·²ç”¨é¢åº¦:m,ç´¯è®¡é‡‘é¢:f,è½¬æ¢åŽç´¯è®¡é‡‘é¢:i.toFixed(2)+"å…ƒ",æœ€ä½Žè¦æ±‚:o+"å…ƒ",æ˜¯å¦æ˜¾ç¤ºæŒ‰é’®:i>=o}),i>=o},P=()=>{q.push("/generate")},$=async()=>{const o=e("redeem.logoutConfirmMessage");await K(o,e("redeem.logoutConfirmTitle"))&&(l.logout(),q.push("/login"),d.success(e("redeem.logoutSuccessMessage"),e("redeem.logoutSuccessTitle")))},E=()=>{const o=g.config.purchaseUrl;o&&window.open(o,"_blank")};return(o,c)=>{var m,f;return S(),y("div",G,[c[3]||(c[3]=t("div",{class:"bg-decoration"},[t("div",{class:"gradient-orb orb-1"}),t("div",{class:"gradient-orb orb-2"}),t("div",{class:"gradient-orb orb-3"})],-1)),t("div",H,[t("div",X,[t("h1",Z,"ðŸ’° "+r(a(e)("redeem.title")),1)]),t("div",ee,[t("div",te,[t("div",se,r(a(e)("redeem.currentBalance")),1),t("div",ae,r(U((m=a(l).profile)==null?void 0:m.quota)),1),a(g).config.balanceLimit.displayBalance>0?(S(),y("div",oe,r(a(e)("redeem.balanceTip",{amount:a(g).config.balanceLimit.displayBalance})),1)):w("",!0)]),t("form",{onSubmit:L(D,["prevent"]),class:"redeem-form"},[t("div",re,[t("label",le,r(a(e)("redeem.redemptionCode")),1),J(t("input",{id:"redemptionCode","onUpdate:modelValue":c[0]||(c[0]=i=>p.value=i),type:"text",placeholder:a(e)("redeem.codePlaceholder"),disabled:B.value,autocomplete:"off"},null,8,ne),[[W,p.value]]),n.value?(S(),y("div",ce," âš ï¸ "+r(n.value),1)):w("",!0)]),t("div",ue,[a(g).config.purchaseUrl&&a(g).config.purchaseUrl.trim()?(S(),y("button",{key:0,onClick:E,class:"purchase-button",type:"button"}," ðŸ›’ "+r(a(e)("redeem.purchaseButton")),1)):w("",!0),t("button",{type:"submit",class:"submit-button",disabled:B.value||!p.value.trim()},r(B.value?a(e)("redeem.redeeming"):a(e)("redeem.redeemButton")),9,ie)])],32),t("div",de,[t("h3",null,r(a(e)("redeem.usageTitle")),1),t("ul",null,[t("li",null,r(a(e)("redeem.usageItem1")),1),t("li",null,r(a(e)("redeem.usageItem2")),1),t("li",null,r(a(e)("redeem.usageItem3")),1),a(g).config.balanceLimit.displayBalance>0?(S(),y("li",me,r(a(e)("redeem.usageItem4",{amount:a(g).config.balanceLimit.displayBalance})),1)):w("",!0)])]),t("div",pe,[A()?(S(),y("button",{key:0,onClick:P,class:"back-button"},r(a(e)("redeem.laterButton")),1)):w("",!0),t("button",{onClick:$,class:"logout-button"},r(a(e)("redeem.logoutButton")),1)])])]),C.value?(S(),y("div",{key:0,class:"modal-overlay",onClick:R},[t("div",{class:"modal-content",onClick:c[1]||(c[1]=L(()=>{},["stop"]))},[c[2]||(c[2]=t("div",{class:"success-icon"},"âœ“",-1)),t("h3",null,r(a(e)("redeem.successTitle")),1),t("p",ge,[N(r(a(e)("redeem.successAmount")),1),t("strong",null,r(U(k.value)),1)]),t("p",fe,[N(r(a(e)("redeem.currentBalanceAfter")),1),t("strong",null,r(U((f=a(l).profile)==null?void 0:f.quota)),1)]),t("button",{onClick:x,class:"modal-button"},r(a(e)("redeem.confirmButton")),1)])])):w("",!0)])}}}),be=j(ve,[["__scopeId","data-v-79b83869"]]);export{be as default};
